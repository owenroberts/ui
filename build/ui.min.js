Array.prototype.insert=function(e,t){this.splice(e,0,t)},Number.prototype.clamp=function(e,t){return Math.min(Math.max(this,e),t)},"undefined"!=typeof window&&(window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}),Cool={},Cool.map=function(e,t,s,i,a){return i+(a-i)*(e-t)/(s-t)||0},Cool.padNumber=function(e,t){let s=""+e;for(;s.length<t;)s="0"+s;return s},Cool.random=function(e,t){return t?Math.random()*(t-e)+e:"number"==typeof e?Math.random()*e:Array.isArray(e)?e[Math.floor(Math.random()*e.length)]:"object"==typeof e?e[Cool.random(Object.keys(e))]:void 0},Cool.randomInt=function(e,t){return t||(t=e,e=0),Math.round(Math.random()*(t-e)+e)},Cool.chance=function(e){return Cool.random(1)<e},Cool.choice=function(e){return Array.isArray(e)||(e=[...arguments]),e[Math.floor(Math.random()*e.length)]},Cool.shuffle=function(e){let t,s=e.length;for(;0!=s;)t=Math.floor(Math.random()*s),s--,[e[s],e[t]]=[e[t],e[s]];return e},Cool.randomNormalInverse=function(){let e=0,t=0;for(;0===e;)e=Math.random();for(;0===t;)t=Math.random();const s=Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*t);let i=Cool.map(s,-3.5,3.5,0,1);return i>.5?i-.5:i+.5},Cool.componentToHex=function(e){var t=e.toString(16);return 1==t.length?"0"+t:t},Cool.HueToRgb=function(e,t,s){return s<0?s+=1:s>1&&(s-=1),255*(6*s<1?e+(t-e)*s*6:2*s<1?t:3*s<2?e+(t-e)*(2/3-s)*6:e)},Cool.hslToHex=function(e){for(var t=0,s=0,i=0,a=0,l=0,n=0,o=0;l<e.length;l++){var c=e.charCodeAt(l);if(c>=48&&c<=57)a=10*a+(c-48),o=1;else{if(1===o){switch(n){case 0:t=a%360/360;break;case 1:s=(a>100?100:a)/100;break;case 2:i=(a>100?100:a)/100}n++}o=0,a=0}}var h=t/(1/6),u=(e=(1-Math.abs(2*i-1))*s)*(1-Math.abs(h%2-1));switch(0|h){case 0:r=e,g=u,b=0;break;case 1:r=u,g=e,b=0;break;case 2:r=0,g=e,b=u;break;case 3:r=0,g=u,b=e;break;case 4:r=u,g=0,b=e;break;case 5:r=e,g=0,b=u}var d=i-.5*e;r+=d,g+=d,b+=d,r=255*r|0,g=255*g|0,b=255*b|0;var p="";return(o=48+(r>>4&15))>57&&(o+=7),p+=String.fromCharCode(o),(o=48+(15&r))>57&&(o+=7),p+=String.fromCharCode(o),(o=48+(g>>4&15))>57&&(o+=7),p+=String.fromCharCode(o),(o=48+(15&g))>57&&(o+=7),p+=String.fromCharCode(o),(o=48+(b>>4&15))>57&&(o+=7),p+=String.fromCharCode(o),(o=48+(15&b))>57&&(o+=7),p+=String.fromCharCode(o)},Cool.hexToRgb=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},Cool.rgbToHsl=function(e){e.r/=255,e.g/=255,e.b/=255;var t,s,i=Math.max(e.r,e.g,e.b),a=Math.min(e.r,e.g,e.b),l=(i+a)/2;if(i==a)t=s=0;else{var n=i-a;switch(s=l>.5?n/(2-i-a):n/(i+a),i){case e.r:t=(e.g-e.b)/n+(e.g<e.b?6:0);break;case e.g:t=(e.b-e.r)/n+2;break;case e.b:t=(e.r-e.g)/n+4}t/=6}return[360*t+.5|0,100*s+.5|0,100*l+.5|0]},Cool.rgb2hex=function(e){var t=e.replace(/\s/g,"").match(/^rgba?\((\d+),(\d+),(\d+)/i);return t&&4===t.length?"#"+("0"+parseInt(t[1],10).toString(16)).slice(-2)+("0"+parseInt(t[2],10).toString(16)).slice(-2)+("0"+parseInt(t[3],10).toString(16)).slice(-2):e},Cool.keys={9:"tab",13:"enter",27:"escape",32:"space",37:"left",38:"up",39:"right",40:"down",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",186:";",187:"+",192:"`",220:"backslash",222:"'"},Cool.Vector=function(e,t){return this.x=e||0,this.y=t||0,Array.isArray(this.x)&&(this.x=e[0],this.y=e[1]),this.random=function(e,t,s,i){return 1==arguments.length?(this.x=Cool.random(-e,e),this.y=Cool.random(-e,e)):2==arguments.length?(this.x=Cool.random(e,t),this.y=Cool.random(e,t)):4==arguments.length?(this.x=Cool.random(e,t),this.y=Cool.random(s,i)):console.error("You need 1, 2 or 4 arguments, dingus."),this},this.zero=function(){return!(Math.abs(this.x)>0||Math.abs(this.y)>0)},this.add=function(e){return this.x+=e.x,this.y+=e.y,this},this.subtract=function(e){return this.x-=e.x,this.y-=e.y,this},this.multiply=function(e){return"object"==typeof e?(this.x*=e.x,this.y*=e.y):(this.x*=e,this.y*=e),this},this.divide=function(e){return"object"==typeof e?(this.x/=e.x,this.y/=e.y):(this.x/=e,this.y/=e),this},this.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},this.normalize=function(){var e=this.magnitude();return 0!=e&&1!=e&&this.divide(e),this},this.copy=function(){return new Cool.Vector(this.x,this.y)},this.distance=function(e){var t=new Cool.Vector(e.x,e.y);return t.subtract(this),t.magnitude()},this.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},this.getObj=function(){return{x:this.x,y:this.y}},this.clone=function(){return new Cool.Vector(this.x,this.y)},this.sameDirection=function(e){return Math.sign(this.x)==Math.sign(e.x)&&Math.sign(this.y)==Math.sign(e.y)},this.toArray=function(){return[this.x,this.y]},this},Cool.mobilecheck=function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t},Cool.testPerformance=function(){for(var e=new Date,t=15e7,s=t;s>0;s--);var i=new Date,a=Number(String(i.getSeconds())+"."+String(i.getMilliseconds()))-Number(String(e.getSeconds())+"."+String(e.getMilliseconds()));return e.getMinutes()!=i.getMinutes()&&(a=60*(i.getMinutes()-e.getMinutes())+a),spd=1.734/a,Math.round(1e3*a)/1e3},"undefined"!=typeof module&&(module.exports=Cool);class UIElement{constructor(e){e=e||{},this.el=document.getElementById(e.id)?document.getElementById(e.id):document.createElement(e.tag||"div");for(const t in e.css)this.el.style[t]=e.css[t];void 0!==e.id&&(this.el.id=e.id),e.class&&this.addClass(e.class),e.text&&(this.el.textContent=e.text)}set text(e){this.el.textContent=e}set value(e){this.el.value=e}get value(){return this.el.value}get position(){return{x:this.el.getBoundingClientRect().x,y:this.el.getBoundingClientRect().y}}setProp(e,t){this.el.style.setProperty(e,t)}getProp(e){return this.el.style.getPropertyValue(e)}keyHandler(){this.callback()}addClass(e){this.el.classList.add(e)}removeClass(e){this.el.classList.remove(e)}setKey(e,t){this.el.title=`${t||""} ~ ${e}`,this.el.addEventListener("mouseenter",this.onPress.bind(this)),this.el.addEventListener("mouseleave",this.onRelease.bind(this))}onPress(e){toolTip.text=`${this.el.title}`,toolTip.addClass("visible"),this.addClass("triggered"),!0===e&&setTimeout(this.onRelease.bind(this),400)}onRelease(){toolTip.removeClass("visible"),this.removeClass("triggered")}remove(){this.el.remove()}}class UICollection extends UIElement{constructor(e){super(e)}append(e,t){void 0!==t&&(this[t]=e),Array.isArray(e.html)?e.html.forEach((e=>{this.el.appendChild(e)})):this.el.appendChild(e.el)}remove(e,t){t&&delete this[t],this.el.removeChild(e.el)}removeK(e){this.el.removeChild(this[e].el),delete this[e]}clear(){for(let e=this.el.children.length-1;e>=0;--e)this.el.children[e].remove()}get uiList(){return Object.keys(this).filter((e=>"el"!==e)).map((e=>this[e]))}}class UIInput extends UIElement{constructor(e){e.tag="input",super(e),this.callback=e.callback,this.args=e.args||[],e.key&&this.setKey(e.key,e.label)}}class UIText extends UIInput{constructor(e){super(e),this.el.type="text",this.placeholder=this.el.placeholder||e.placeholder||e.text||e.value||"",this.el.placeholder=this.placeholder,this.el.addEventListener("focus",(e=>{this.el.select()})),this.el.addEventListener("keyup",(e=>{13==e.which&&(this.update(e.target.value),this.el.blur())})),this.el.addEventListener("blur",(e=>{this.value?this.value!=e.target.value&&e.target.value&&this.update(e.target.value):(this.el.placeholder=this.placeholder,this.el.value="")}))}keyHandler(e){this.update(prompt(this.prompt))}update(e,t){this.value=e,this.callback&&!t&&this.callback(e)}set value(e){this._value=e,this.placeholder=e,this.el.placeholder=e,this.el.value=""}get value(){return this._value||this.placeholder}}function Interface(e,t){const s=this,i={UILabel:UILabel,UIElement:UIElement,UIRange:UIRange,UIText:UIText,UINumber:UINumber,UINumberRange:UINumberRange,UINumberStep:UINumberStep,UIToggle:UIToggle,UIToggleCheck:UIToggleCheck,UIButton:UIButton,UIColor:UIColor,UISelect:UISelect,UISelectButton:UISelectButton,UICollection:UICollection,UIList:UIList,UIRow:UIRow,UIInput:UIInput,UIInputList:UIInputList,UIFile:UIFile};document.body.classList.add(Cool.mobilecheck()?"mobile":"desktop"),this.keys={},this.faces={},this.panels=new UICollection({id:"ui-panels",class:"panels"}),this.quickRef=new QuickRef(e),this.maxPanels=100,this.maxWidth=500,this.useMaxWidth=!1,this.panels.append(new UIElement({id:"panel-break"})),this.layout=new Layout(this,t);let a=11;this.updateScale=function(e){e&&(a=+e),document.body.style.setProperty("--base-font-size",a)},this.keyDown=function(e){let t=Cool.keys[e.which];"space"===t&&e.preventDefault(),t=e.shiftKey?"shift-"+t:t,t=e.ctrlKey?"ctrl-"+t:t,t=e.altKey?"alt-"+t:t;const i=s.keys[t];t&&i&&"text"!==document.activeElement.type&&"number"!==document.activeElement.type&&!e.metaKey&&(e.preventDefault(),i.keyHandler(e.target.value),i.onPress(!0))},document.addEventListener("keydown",s.keyDown,!1),this.load=function(t,i){!async function(t,i){const a=await fetch(t).then((e=>e.json())),l={...await fetch("../ui/interface.json").then((e=>e.json()))};for(const e in a)l[e]?l[e].uis.push(...a[e].uis):l[e]={...a[e]};for(const t in l){const i=s.panels[t]||s.createPanel(t,l[t]),a=l[t].uis;for(let n=0;n<a.length;n++){const o=a[n];for(let e=0;e<o.list.length;e++)s.createUI(o.list[e],o.module,o.sub,i);"ui"===o.module&&o.sub&&(e.ui[o.sub].panel=i),l[t].addPanel&&!e[o.module].panel&&(e[o.module].panel=i)}}s.layout.addSelectPanels([...Object.keys(l).map((e=>[e,l[e].label]))]),s.quickRef.addData(l),s.panels.layout.dock(),i&&i()}(t,i)},this.createPanel=function(e,t){const s=new UIPanel({id:e,label:t.label,onToggle:function(){lns.ui.panels.uiList.filter((e=>e.isOpen&&e.isDocked))}});return this.panels.append(s,e),s},this.createUI=function(t,a,l,n){const o=l?e[a][l]:e[a],r={...t.params};t.key&&(r.key=t.key),t.callback&&(r.callback=o[t.callback]);for(const e in t.fromModule)r[e]=o[t.fromModule[e]];t.number&&(r.callback=function(e){o[t.number]=+e},r.value=+o[t.number]),t.string&&(r.callback=function(e){o[t.string]=e},r.value=o[t.string]),t.toggle&&(r.callback=function(e){o[t.toggle]=void 0!==e?e:!o[t.toggle]},r.value=o[t.number]),t.row&&n.addRow(),t.label&&n.add(new UILabel({text:t.label}));let c=new i[t.type](r);"UIRow"==t.type?n.addRow(t.k,r.class):t.k?n.add(c,void 0,t.k):n.add(c),r.prompt&&(c.prompt=r.prompt),r.key&&(s.keys[t.key]=c),t.face&&(s.faces[t.face]=c),t.face&&t.ignoreSettings&&(c.ignoreSettings=!0)},this.update=function(){e.uiUpdate()}}function Layout(e,t){const s=this,i=new UICollection({id:"container"}),a=new UICollection({id:"interface"});i.append(a);const l=new UICollection({id:"selector"});a.append(l),a.append(e.panels);const n=new UICollection({id:"ui-timeline"});i.append(n);const o=new UICollection({id:"timeline-panels",class:"panels"});n.append(o);const r=new UICollection({id:"main"}),c=new UICollection({id:"main-panels"});r.append(c),window.toolTip=new UILabel({id:"tool-tip"}),a.append(window.toolTip),this.toggleTimelineView=function(t){const s=t?o:e.panels;for(const t in e.panels)"timeline"===e.panels[t].gridArea&&s.append(e.panels[t])},this.toggleRL=function(e){e?i.addClass("RL"):i.removeClass("RL")},this.addSelectPanels=function(e){e.forEach((e=>{const[t,i]=e;s.panel.layout.uiSelect.addOption(t,!1,i)}))},this.dockPanel=function(t){const i=e.panels[s.panel.layout.uiSelect.value];i.dock(),i.gridArea!==t&&(i.gridArea=t,"default"===t&&e.panels.append(i),"main"===t&&c.append(i)),"timeline"===t&&s.toggleTimelineView(!0)}}function QuickRef(e){const t=this,s={};this.fontSize=11,this.list=[],this.setScale=function(e){t.fontSize=+e,document.body.style.setProperty("--quick-ref-font-size",+e)},this.reset=function(){lns.ui.faces.quickRefScale.update(11)},this.addRef=function(){const i=new UIModal({title:"panels",app:e,position:t.panel.position,callback:function(){const l={};if(s[a.value].uis.forEach((e=>{e.list.forEach((t=>{let s=!(!t.number&&!t.toggle);if(t.fromModule&&(s=!!t.fromModule.callback),s){const s=t.params?t.params.text||t.params.onText||t.params.label||t.face:t.fromModule.callback;t.mod=e.module,t.sub=e.sub,l[s]=t}}))})),Object.keys(l).length>0){const s=new UIModal({title:"ui",app:e,position:t.panel.position,callback:function(){const s=l[i.value];e.ui.createUI(s,s.mod,s.sub,t.panel);t.list.push(s)}}),i=new UISelect({options:Object.keys(l)});s.add(i);const a=new UIButton({text:"Execute",callback:function(){s.clear();const t=l[i.value],a=t.sub?e[t.mod][t.sub]:e[t.mod];t.fromModule&&t.fromModule.callback&&a[t.fromModule.callback](),t.number&&(a[t.number]=+prompt(t.prompt||t.label)),t.toggle&&(a[t.toggle]=!a[t.toggle])}});s.add(a)}else i.clear()}}),a=new UISelect({options:Object.keys(s)});i.add(a)},this.addData=function(e){for(const t in e)s[t]=e[t]},this.openQuickMenu=function(){let t=["UIRow","UILabel"],i={};Object.keys(s).forEach((e=>s[e].uis.forEach((a=>a.list.filter((e=>!t.includes(e.type))).filter((e=>"ctrl-space"!==e.key)).forEach((t=>{let l=s[e].label+" > ",n=t.label;!n&&t.params&&(n=t.params.text||t.params.onText||t.params.placeholder),n||(n=t.face),n||console.error("quick search fuck",t),l+=n,t.key&&(l+=` (key: ${t.key})`),i[l]={...t,module:a.module,sub:a.sub}}))))));const a=new UIModal({title:"Quick Func",app:e,position:{x:window.innerWidth/2,y:window.innerHeight/2},callback:()=>{const t=i[l.value],s=t.sub?e[t.module][t.sub]:e[t.module];let n;t.params&&t.params.args&&(n=[t.params.args]),t.face?e.ui.faces[t.face].update():t.callback?n?s[t.callback](...n):s[t.callback]():t.fromModule?t.fromModule.callback&&(n?s[t.fromModule.callback](...n):s[t.fromModule.callback]()):t.number?s[t.number]=+prompt(t.prompt||t.label):t.toggle&&(s[t.toggle]=!a[t.toggle])}}),l=new UIInputList({listName:"quick-menu-list",options:Object.keys(i),callback:function(){a.clear(),a.callback()}});a.add(l),l.input.el.focus(),l.input.el.addEventListener("keydown",(e=>{"escape"===Cool.keys[e.which]&&a.clear()}))}}function Settings(e,t,s,i){const a=this,l=`settings-${t}`;function n(t){for(const s in t){if("el"===s)continue;if(!e.ui.panels[s])continue;let i=e.ui.panels[s],a=t[s];a.docked?i.dock():i.undock(),a.open||i.close(),a.block&&i.block(),a.headless&&i.headless(),i.order=a.order,i.gridArea=a.gridArea}}function o(t){for(const s in t)"palettes"!==s&&"quickRef"!==s&&e.ui.faces[s]&&e.ui.faces[s].update(t[s])}this.save=function(){const t={},i={};Object.keys(e.ui.faces).filter((t=>!e.ui.faces[t].ignoreSettings)).forEach((t=>{i[t]=e.ui.faces[t].value}));const a=s?{...i,...s()}:{...i};t.interface=a,t.panels={};for(const s in e.ui.panels)"el"!==s&&(t.panels[s]=e.ui.panels[s].settings);t.quickRef=e.ui.quickRef.list,localStorage[l]=JSON.stringify(t)},this.load=function(t){if(localStorage[l]){const t=JSON.parse(localStorage[l]);n(t.panels),o(t.interface),t.quickRef&&(e.ui.quickRef.list=t.quickRef,t.quickRef.forEach((t=>{e.ui.createUI(t,t.mod,t.sub,e.ui.panels.quickRef)})))}},this.clear=function(){localStorage.setItem(l,"")},this.toggleSaveSettings=function(){e.files.saveSettingsOnUnload=!e.files.saveSettingsOnUnload},i||(i=[]),i=[...i,"timelineView","interfaceScale","rl"],this.saveLayout=function(){a.save();const t={};i.forEach((s=>{t[s]=e.ui.faces[s].value}));const s=JSON.parse(localStorage.getItem(l)).panels,n=JSON.stringify({panels:s,interface:t}),o=prompt("Layout Name:","New Layout"),r=new Blob([n],{type:"application/x-download;charset=utf-8"});saveAs(r,`${o}.json`)},this.loadLayoutFile=function(e){if(e)fetch(e).then((e=>e.json())).then((e=>{o(e.interface),n(e.panels)})).catch((e=>{console.error(e)}));else{const e=document.createElement("input");e.type="file",e.click(),e.onchange=function(){for(let t,s=0;t=e.files[s];s++){if(!t.type.match("application/json"))continue;const e=new FileReader;e.onload=function(e){const t=JSON.parse(e.target.result);n(t.panels),o(t.interface)},e.readAsText(t)}}}}}class UIButton extends UIElement{constructor(e){e.tag="span",super(e),this.addClass(e.type||"btn"),this.text=this.el.textContent||e.text||e.onText,this.callback=e.callback,this.args=e.args||[],this.el.addEventListener("click",this.keyHandler.bind(this)),e.key&&this.setKey(e.key,`${this.el.textContent}`)}keyHandler(){this.callback(...this.args)}}class UIColor extends UIInput{constructor(e){super(e),this.el.type="color",this.colors=[],this.args=e.args||[],this.el.addEventListener("input",(e=>{this.setColor(e.target.value)})),this.el.addEventListener("focus",(e=>{this.addColor(this.current)})),this.palette=new UICollection}addColor(e){const t=this;if(!this.colors.includes(e)&&e){this.colors.push(e);const s=new UIButton({text:e,css:{background:e},value:e,callback:function(){t.update(e)}});t.palette.append(s)}}setColor(e){this.current=e,this.callback(e,...this.args)}update(e,t){t||this.setColor(e),this.value=e}set value(e){this.addColor(e),this.current=e,super.value=e}get value(){return this.el.value}get html(){return[this.el,this.palette.el]}}class UIDrag extends UIText{constructor(e){super(e),this.addClass("drag");const t=this,s={x:0,y:0,timeout:5,timer:0,prev:0,active:!1};function i(t){if(!s.active)return;const i={x:t.pageX-s.x,y:t.pageY-s.y},a=Math.abs(i.x)>Math.abs(i.y)?"x":"y";if(Math.abs(i[a])>10&&0===s.timer){const l="x"===a?1:-1;e.drag&&e.drag(l*Math.sign(i[a])),s.timer=s.timeout,s.x=t.pageX,s.y=t.pageY}else s.timer>0&&s.timer--}function a(e){s.active&&(s.active=!1,s.x=0,s.y=0,t.el.blur(),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",a))}this.el.addEventListener("mousedown",(function(e){s.x=e.pageX,s.y=e.pageY,s.active=!0,document.addEventListener("mousemove",i),document.addEventListener("mouseup",a)})),void 0!==e.value&&(this.value=e.value)}}class UIDragButton extends UIButton{constructor(e){super(e),this.down={x:0,y:0},this.el.addEventListener("mousemove",(e=>{this.down.x&&(this.dragging=!0)})),this.el.addEventListener("mousedown",(e=>{this.down.x=e.pageX})),document.addEventListener("mouseup",(e=>{if(this.dragging){const t=e.pageX-this.down.x;Math.abs(t)>10&&this.callback(t>0?1:-1,Math.abs(Math.ceil(t/lns.ui.timeline.frameWidth)))}this.dragging=!1,this.down.x=0}))}}class UIFile extends UIButton{constructor(e){super(e),this.multiple=e.multiple||!1,this.promptDefault=e.promptDefault}keyHandler(){const{callback:e,promptDefault:t,multiple:s}=this;const i=document.createElement("input");i.type="file",i.multiple=s,i.click(),i.onchange=function(){let s=prompt("Directory?",t);!function(t,s){for(let i,a=0;i=t[a];a++){if(!i.type.match("application/json"))continue;const t=new FileReader;t.onload=function(t){const a=s+i.name,l=i.name.split(".")[0];e(JSON.parse(t.target.result),l,a)},t.readAsText(i)}}(i.files,s)}}}class UIInputList extends UICollection{constructor(e){super(e),this.input=new UIElement({tag:"input",class:"search"}),this.input.el.setAttribute("list",e.listName),this.input.el.addEventListener("change",(t=>{this.input.el.blur(),e.callback()&&e.callback()})),this.list=new UIElement({tag:"datalist",id:e.listName}),this.setOptions(e.options||[])}get html(){return[this.input.el,this.list.el]}get value(){return this.input.el.value}addOption(e,t,s){const i=document.createElement("option");i.value=i.textContent=e,t&&(i.selected="selected"),s&&(i.textContent=s),this.list.el.appendChild(i)}setOptions(e,t){for(let s=0;s<e.length;s++){Array.from(this.list.el.options).map((e=>e.value)).includes(e[s])||this.addOption(e[s],t==e[s])}}}class UILabel extends UIElement{constructor(e){e.tag="label",super(e),this.text=e.text}}class UIList extends UICollection{constructor(e){super(e)}insertBefore(e,t){this.el.insertBefore(e.el,t.el)}get length(){return this.el.children.length}get children(){return this.el.children}addClass(e){for(let t=0;t<this.els.length;t++)this.els[t].classList.contains(e)||this.els[t].classList.add(e)}setId(e,t){this.children[t].id=e}removeIndex(e){this.children[e].remove()}looper(e,t,s){const i=s||this.length-2;for(let s=t||0;s<=i;s++)e(this.children[s])}}class UIListStep extends UICollection{constructor(e){super(e),this.addClass("list-step"),this.addClass("ui-collection");const t=e.list;let s=void 0!==e.value?e.list.indexOf(e.value):0;e.callback&&(this.callback=e.callback),this.textInput=new UIDrag({value:e.value,class:"left-end",drag:e=>{s+e>=0&&s+e<t.length&&(s+=e),this.update(t[s])},callback:e=>{this.update(e)}});const i=new UIButton({text:"▼",class:"middle",callback:()=>{s>0&&(s-=1),this.update(t[s])}}),a=new UIButton({text:"▲",class:"right-end",callback:()=>{s<=t.length&&(s+=1),this.update(t[s])}});this.append(this.textInput),this.append(i),this.append(a)}update(e,t){this.value=e,!t&&this.callback&&(this.args?this.callback(e,...this.args):this.callback(e))}set value(e){this.textInput.value=e}get value(){return this.textInput.value}}class UIModal extends UICollection{constructor(e){super({}),e.callback&&(this.callback=e.callback),this.addClass("modal"),this.append(new UILabel({text:e.title})),document.getElementById("container").appendChild(this.el);const t=this;this.break=new UIElement({class:"break"}),this.append(this.break),this.submit=new UIButton({text:"Submit",callback:function(){e.callback&&e.callback(),t.clear()}}),this.append(this.submit),e.app.ui.keys.enter=this.submit,this.cancel=new UIButton({text:"x",callback:t=>{this.clear(),e.onClear&&e.onClear()}}),e.app.ui.keys.escape=this.cancel,this.append(this.cancel);let s=Math.max(16,e.position.x-100),i=Math.max(16,e.position.y-20);this.el.style.left=`${s}px`,this.el.style.top=`${i}px`}adjustPosition(){let e=parseInt(this.el.style.left),t=parseInt(this.el.style.top),s=parseInt(this.el.offsetWidth),i=parseInt(this.el.offsetHeight);e+s>window.innerWidth&&(this.el.style.left=e-s+"px"),t+i>window.innerHeight&&(this.el.style.top=t-i+"px")}add(e){Array.isArray(e.html)?e.html.forEach((e=>{this.el.insertBefore(e,this.break.el)})):this.el.insertBefore(e.el,this.break.el)}addBreak(e){this.add(new UIElement({class:"break"})),e&&this.addLabel(e)}addLabel(e){this.add(new UILabel({text:e}))}clear(){this.el.remove()}}class UINumber extends UIText{constructor(e){super(e),this.el.classList.add("number"),this.placeholder||(this.placeholder=0,this.el.placeholder=0)}update(value,uiOnly){if(void 0!==value){if("string"==typeof value&&value.match(/\D/))try{value=eval(value)}catch(e){return void alert("Please enter a numerical value or mathematical expression.")}this.value=value,this.callback&&!uiOnly&&this.callback(value)}}keyHandler(e){this.update(+prompt(this.prompt))}}class UINumberList extends UICollection{constructor(e){super(e),this.addClass("number-list"),this.list=[...e.list],e.callback&&(this.callback=e.callback);const t=new UIButton({text:"+",callback:()=>{this.addNumber(this.list.length,0)}}),s=new UIButton({text:"X",callback:()=>{this.list.pop(),this.removeK("n"+this.list.length)}});this.append(s),this.append(t);for(let e=0;e<this.list.length;e++)this.addNumber(e,this.list[e])}addNumber(e,t){const s=new UINumber({value:t,callback:t=>{this.list[e]=+t,this.callback&&this.callback(this.list)}});this.append(s,"n"+e)}}class UINumberRange extends UICollection{constructor(e){super(e),this.callback=e.callback,this.args=e.args||[],this.numberInput=new UINumber({...e,callback:this.update.bind(this)}),this.range=new UIRange({...e,callback:this.update.bind(this)}),"change"===e.event&&this.range.el.addEventListener("input",(e=>{this.numberInput.el.placeholder=e.currentTarget.value})),void 0!==e.value&&(this.value=e.value)}get html(){return[this.numberInput.el,this.range.el]}keyHandler(e){this.update(+prompt(this.prompt))}update(e,t){t||this.callback(+e,...this.args),this.value=e}set value(e){this.numberInput.value=e,this.range.value=e}get value(){return+this.numberInput.value}}class UINumberStep extends UICollection{constructor(e){super(e),this.addClass("number-step"),this.addClass("ui-collection"),this.callback=e.callback,this.args=e.args,this.step=+e.step||1,this.min=+e.min||0,this.max=+e.max||100,this.numberInput=new UIDrag({...e,class:"middle",drag:e=>{this.update(this.value+this.step*e)},callback:e=>{this.update(+e)}}),this.stepDown=new UIButton({text:"◀",class:"left-end",callback:()=>{this.update(this.value-this.step)}}),this.stepUp=new UIButton({text:"▶",class:"right-end",callback:()=>{this.update(this.value+this.step)}}),this.append(this.stepDown),this.append(this.numberInput),this.append(this.stepUp)}keyHandler(e){this.update(+prompt(this.prompt))}update(e,t){e<this.min&&(e=this.min),e>this.max&&(e=this.max),this.value=e,t||(this.args?this.callback(e,...this.args):this.callback(e))}get html(){return this.el}set value(e){this.numberInput.value=+e}get value(){return this.numberInput.value}}class UIPanel extends UICollection{constructor(e){super({id:`${e.id}-panel`}),this.addClass("panel"),this.addClass("undocked"),this.gridArea="default",this.rows=[],this.header=new UIRow,this.header.addClass("header"),this.append(this.header),this.open=new UIToggle({onText:"－",offText:"＋",type:"toggle",isOn:!0,callback:()=>{this.open.isOn?this.removeClass("closed"):this.addClass("closed")}}),this.header.append(this.open),this.header.append(new UILabel({text:e.label})),this.header.append(new UIButton({text:"X",type:"undock-btn",callback:this.undock.bind(this)})),this.orderBtn=new UIButton({text:this.order||"0",type:"order-btn",callback:()=>{this.order=+this.el.style.order+1,this.orderBtn.text=this.order}}),this.header.append(this.orderBtn),this.header.append(new UIButton({text:"[]",type:"block-btn",callback:()=>{this.el.classList.contains("block")?this.el.classList.remove("block"):this.el.classList.add("block")}})),this.header.append(new UIButton({text:"<",type:"headless-btn",callback:()=>{this.el.classList.contains("headless")?this.el.classList.remove("headless"):this.el.classList.add("headless")}}))}set order(e){this.orderBtn.text=e||"0",this.el.style.order=e}get order(){return this.el.style.order}get isDocked(){return!this.el.classList.contains("undocked")}get isBlock(){return this.el.classList.contains("block")}get isHeadless(){return this.el.classList.contains("headless")}get isOpen(){return this.open.value}get settings(){return{open:this.isOpen,docked:this.isDocked,order:this.order,block:this.isBlock,headless:this.isHeadless,gridArea:this.gridArea}}close(){this.addClass("closed"),this.open.set(!1)}block(){this.el.classList.add("block")}headless(){this.el.classList.add("headless")}dock(){this.removeClass("undocked")}undock(){this.addClass("undocked")}addRow(e,t){const s=new UIRow({class:t,id:e});return this.append(s,e),this.rows.push(s),s}removeRow(e){const t=this.rows.indexOf(e);this.rows.splice(t,1),this.remove(e)}add(e,t,s){(t||this.rows[this.rows.length-1]||this.addRow()).append(e,s)}}class UIRange extends UIInput{constructor(e){super(e),this.el.type="range",this.setRange(e.min,e.max),this.value=e.value||e.min,e.step&&this.setStep(e.step),this.el.addEventListener(e.event||"input",(e=>{this.update(e.target.value)}))}keyHandler(e){this.update(+prompt(this.prompt))}update(e){this.el.value=e,this.el.blur(),this.callback(e)}setRange(e,t){this.el.min=e,this.el.max=t}setStep(e){this.el.step=e}}class UIRow extends UICollection{constructor(e){super(e),this.addClass("row"),this.uiChildren=[],this.keys=[]}append(e,t){super.append(e,t),t&&this.keys.push(t),this.uiChildren.push(e)}clear(){for(const e in this.keys)delete this[e];for(this.keys=[];this.el.firstChild;)this.el.firstChild.value=null,this.el.removeChild(this.el.firstChild);this.uiChildren=[]}remove(e,t){super.remove(e,t);let s=this.uiChildren.indexOf(e);this.uiChildren.splice(s,1)}get children(){return this.uiChildren}}class UISelect extends UIElement{constructor(e){e.tag="select",super(e),e.callback&&(this.callback=e.callback),this.setOptions(e.options||[],e.selected),this.el.addEventListener("change",(function(t){e.callback&&e.callback(t.target.value),t.target.blur()}))}update(e){this.value=e,this.callback&&this.callback(e)}removeOption(e){for(let t=0;t<this.el.children.length;t++)this.el.children[t].value==e&&this.el.children[t].remove()}addOption(e,t,s){const i=document.createElement("option");i.value=i.textContent=e,t&&(i.selected="selected"),s&&(i.textContent=s),this.el.appendChild(i)}setOptions(e,t){for(let s=0;s<e.length;s++){const i=Array.from(this.el.options).map((e=>e.value)),{value:a,text:l}="string"==typeof e[s]?{value:e[s]}:e[s];i.includes(a)||this.addOption(a,t==e[s],l)}}}class UISelectButton extends UICollection{constructor(e){super(e);const t=new UISelect({options:e.options,callback:function(){}}),s=new UIButton({text:"+",css:{"margin-left":"1px"},callback:()=>{e.callback(t.value)}});this.append(t,"select"),this.append(s),e.btns&&e.btns.forEach((e=>{const s=new UIButton({text:e.text,css:{"margin-left":"1px"},callback:()=>{e.callback(t.value)}});this.append(s)}))}}class UIToggle extends UIButton{constructor(e){super(e),this.onText=e.onText||e.text,this.offText=e.offText||e.text,super.text=this.offText,this.isOn=!1,e.isOn&&this.toggle(),this.addClass("toggle")}update(e,t){e!==this.isOn&&(void 0===this.isOn&&(this.isOn=e),t||this.callback(e),this.set(e))}keyHandler(){this.toggle(),this.callback(this.value)}set(e){this.isOn=e,e?this.on():this.off()}toggle(){this.isOn=!this.isOn,this.isOn?this.on():this.off()}on(){this.text=this.onText,this.addClass("on")}off(){this.text=this.offText,this.removeClass("on")}get value(){return this.isOn}}class UIToggleCheck extends UICollection{constructor(e){super(e),this.callback=e.callback,this.addClass("ui-collection"),this.check=new UIElement({tag:"input",class:"toggle-check"}),e.label&&this.append(new UILabel({text:e.label})),this.check.el.type="checkbox",this.check.el.checked=e.isOn||!1,this.check.el.addEventListener("change",(e=>{this.callback&&this.callback(e.target.checked),this.check.el.blur()})),this.el.appendChild(this.check.el)}get value(){return this.check.el.checked}keyHandler(e){this.update(void 0!==e?e:!this.value)}update(e){this.check.el.checked=e,this.callback&&this.callback(e)}}class UIChance extends UICollection{constructor(e){super(e),this.addClass("value-bg"),this.step=e.step,this.min=e.min,this.max=e.max,this.value=e.value,this.total=e.max-e.min,e.callback&&(this.callback=e.callback),this.drag=new UIDrag({value:e.value,drag:e=>{this.update(this.value+this.step*e*10)},callback:e=>{this.update(+e)}});const t=new UILabel({text:e.label});this.append(t),this.append(this.drag),this.setProp("--value-percent",Math.round((this.value-this.min)/this.total*100))}update(e,t){e<this.min&&(e=this.min),e>this.max&&(e=this.max),this.value=+e.toFixed(3),this.drag.value=this.value,this.setProp("--value-percent",Math.round((this.value-this.min)/this.total*100)),t||(this.args?this.callback(e,...this.args):this.callback(e))}}
//# sourceMappingURL=src_maps/ui.min.js.map
