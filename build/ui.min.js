(function(){"use strict";Array.prototype.insert=function(e,t){this.splice(e,0,t)},Number.prototype.clamp=function(e,t){return t>e?Math.min(Math.max(this,e),t):Math.min(Math.max(this,t),e)},"undefined"!=typeof window&&(window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)});const Cool={map:function(e,t,s,i,a,l){let n=i+(a-i)*(e-t)/(s-t)||0;return l?n.clamp(i,a):n},padNumber:function(e,t){let s=""+e;for(;s.length<t;)s="0"+s;return s},random:function(e,t){return t?Math.random()*(t-e)+e:"number"==typeof e?Math.random()*e:Array.isArray(e)?e[Math.floor(Math.random()*e.length)]:"object"==typeof e?e[Cool.random(Object.keys(e))]:void 0},randomInt:function(e,t){return t||(t=e,e=0),Math.round(Math.random()*(t-e)+e)}};Cool.randInt=Cool.randomInt,Cool.chance=function(e){return Cool.random(1)<e},Cool.choice=function(e){return Array.isArray(e)||(e=[...arguments]),e[Math.floor(Math.random()*e.length)]},Cool.shuffle=function(e){let t,s=e.length;for(;0!=s;)t=Math.floor(Math.random()*s),s--,[e[s],e[t]]=[e[t],e[s]];return e},Cool.randomNormalInverse=function(){let e=0,t=0;for(;0===e;)e=Math.random();for(;0===t;)t=Math.random();const s=Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*t);let i=Cool.map(s,-3.5,3.5,0,1);return i>.5?i-.5:i+.5},Cool.componentToHex=function(e){var t=e.toString(16);return 1==t.length?"0"+t:t},Cool.HueToRgb=function(e,t,s){return s<0?s+=1:s>1&&(s-=1),255*(6*s<1?e+(t-e)*s*6:2*s<1?t:3*s<2?e+(t-e)*(2/3-s)*6:e)},Cool.hslToHex=function(e){for(var t=0,s=0,i=0,a=0,l=0,n=0,o=0;l<e.length;l++){var c=e.charCodeAt(l);if(c>=48&&c<=57)a=10*a+(c-48),o=1;else{if(1===o){switch(n){case 0:t=a%360/360;break;case 1:s=(a>100?100:a)/100;break;case 2:i=(a>100?100:a)/100}n++}o=0,a=0}}var h=t/(1/6),d=(e=(1-Math.abs(2*i-1))*s)*(1-Math.abs(h%2-1));switch(0|h){case 0:r=e,g=d,b=0;break;case 1:r=d,g=e,b=0;break;case 2:r=0,g=e,b=d;break;case 3:r=0,g=d,b=e;break;case 4:r=d,g=0,b=e;break;case 5:r=e,g=0,b=d}var u=i-.5*e;r+=u,g+=u,b+=u,r=255*r|0,g=255*g|0,b=255*b|0;var p="";return(o=48+(r>>4&15))>57&&(o+=7),p+=String.fromCharCode(o),(o=48+(15&r))>57&&(o+=7),p+=String.fromCharCode(o),(o=48+(g>>4&15))>57&&(o+=7),p+=String.fromCharCode(o),(o=48+(15&g))>57&&(o+=7),p+=String.fromCharCode(o),(o=48+(b>>4&15))>57&&(o+=7),p+=String.fromCharCode(o),(o=48+(15&b))>57&&(o+=7),p+=String.fromCharCode(o)},Cool.hexToRgb=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},Cool.rgbToHsl=function(e){e.r/=255,e.g/=255,e.b/=255;var t,s,i=Math.max(e.r,e.g,e.b),a=Math.min(e.r,e.g,e.b),l=(i+a)/2;if(i==a)t=s=0;else{var n=i-a;switch(s=l>.5?n/(2-i-a):n/(i+a),i){case e.r:t=(e.g-e.b)/n+(e.g<e.b?6:0);break;case e.g:t=(e.b-e.r)/n+2;break;case e.b:t=(e.r-e.g)/n+4}t/=6}return[360*t+.5|0,100*s+.5|0,100*l+.5|0]},Cool.rgb2hex=function(e){var t=e.replace(/\s/g,"").match(/^rgba?\((\d+),(\d+),(\d+)/i);return t&&4===t.length?"#"+("0"+parseInt(t[1],10).toString(16)).slice(-2)+("0"+parseInt(t[2],10).toString(16)).slice(-2)+("0"+parseInt(t[3],10).toString(16)).slice(-2):e},Cool.keys={9:"tab",13:"enter",27:"escape",32:"space",37:"left",38:"up",39:"right",40:"down",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",186:";",187:"+",188:",",190:".",191:"/",192:"`",219:"[",220:"backslash",221:"]",222:"'"},Cool.Vector=function(e,t){return this.x=e||0,this.y=t||0,Array.isArray(this.x)&&(this.x=e[0],this.y=e[1]),this.random=function(e,t,s,i){return 1==arguments.length?(this.x=Cool.random(-e,e),this.y=Cool.random(-e,e)):2==arguments.length?(this.x=Cool.random(e,t),this.y=Cool.random(e,t)):4==arguments.length?(this.x=Cool.random(e,t),this.y=Cool.random(s,i)):console.error("You need 1, 2 or 4 arguments, dingus."),this},this.zero=function(){return!(Math.abs(this.x)>0||Math.abs(this.y)>0)},this.add=function(e){return this.x+=e.x,this.y+=e.y,this},this.subtract=function(e){return this.x-=e.x,this.y-=e.y,this},this.multiply=function(e){return"object"==typeof e?(this.x*=e.x,this.y*=e.y):(this.x*=e,this.y*=e),this},this.divide=function(e){return"object"==typeof e?(this.x/=e.x,this.y/=e.y):(this.x/=e,this.y/=e),this},this.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},this.normalize=function(){var e=this.magnitude();return 0!=e&&1!=e&&this.divide(e),this},this.copy=function(){return new Cool.Vector(this.x,this.y)},this.distance=function(e){var t=new Cool.Vector(e.x,e.y);return t.subtract(this),t.magnitude()},this.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},this.getObj=function(){return{x:this.x,y:this.y}},this.clone=function(){return new Cool.Vector(this.x,this.y)},this.sameDirection=function(e){return Math.sign(this.x)==Math.sign(e.x)&&Math.sign(this.y)==Math.sign(e.y)},this.toArray=function(){return[this.x,this.y]},this},Cool.mobilecheck=function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t},Cool.testPerformance=function(){for(var e=new Date,t=15e7,s=t;s>0;s--);var i=new Date,a=Number(String(i.getSeconds())+"."+String(i.getMilliseconds()))-Number(String(e.getSeconds())+"."+String(e.getMilliseconds()));e.getMinutes()!=i.getMinutes()&&(a=60*(i.getMinutes()-e.getMinutes())+a);return Math.round(1e3*a)/1e3},Cool.tileMap=[0,4,68,64,117,71,197,93,7,199,215,193,1,5,69,65,23,223,247,209,95,255,221,241,17,21,85,81,29,127,253,113,31,119,"x",245,16,20,84,80,219,92,116,87,28,125,124,112],"undefined"!=typeof module&&(module.exports=Cool),"undefined"!=typeof window&&(window.Cool=Cool),window.UI={Elements:{}};class UIElement{constructor(e){e=e||{},this.el=document.getElementById(e.id)?document.getElementById(e.id):document.createElement(e.tag||"div");for(const t in e.css)this.el.style[t]=e.css[t];void 0!==e.id&&(this.el.id=e.id),e.class&&this.addClass(e.class),e.text&&(this.el.textContent=e.text)}set text(e){this.el.textContent=e}set value(e){this.el.value=e}get value(){return this.el.value}get position(){return{x:this.el.getBoundingClientRect().x,y:this.el.getBoundingClientRect().y}}getPosition(){return{x:this.el.getBoundingClientRect().x,y:this.el.getBoundingClientRect().y}}setProp(e,t){this.el.style.setProperty(e,t)}getProp(e){return this.el.style.getPropertyValue(e)}keyHandler(){this.callback()}addClass(e){this.el.classList.add(e)}removeClass(e){this.el.classList.remove(e)}setKey(e,t){this.el.title=`${t||""} ~ ${e}`,this.el.addEventListener("mouseenter",this.onPress.bind(this)),this.el.addEventListener("mouseleave",this.onRelease.bind(this))}onPress(e){ToolTip.text=`${this.el.title}`,ToolTip.addClass("visible"),this.addClass("triggered"),!0===e&&setTimeout(this.onRelease.bind(this),400)}onRelease(){ToolTip.removeClass("visible"),this.removeClass("triggered")}remove(){this.el.remove()}}UI.Elements.UIElement=UIElement;class UICollection extends UIElement{constructor(e){super(e)}append(e,t){return void 0!==t&&(this[t]=e),Array.isArray(e.html)?e.html.forEach((e=>{this.el.appendChild(e)})):this.el.appendChild(e.el),e}insert(e,t){this.el.insertBefore(e.el,t.el)}add(e,t){return this.append(e,t),e}remove(e,t){t&&delete this[t],this.el.removeChild(e.el)}removeK(e){this.el.removeChild(this[e].el),delete this[e]}clear(){for(let e=this.el.children.length-1;e>=0;--e)this.el.children[e].remove()}get uiList(){return Object.keys(this).filter((e=>"el"!==e)).map((e=>this[e]))}}UI.Elements.UICollection=UICollection;class UIListAdd extends UICollection{constructor(e){super(e),this.list=[...e.list],e.callback&&(this.callback=e.callback);const t=new UIButton({text:"X",callback:()=>{this.list.length>0&&(this.removeK("n"+(this.list.length-1)),this.list.pop()),this.callback(this.list)}});this.append(t)}addItems(){for(let e=0;e<this.list.length;e++)this.addItem(e,this.list[e])}set(e){for(let e=this.list.length-1;e>=0;e--)this.removeK("n"+e);this.list=e;for(let e=0;e<this.list.length;e++)this.addItem(e,this.list[e])}}UI.Elements.UIListAdd=UIListAdd;class UIInputList extends UIListAdd{constructor(e){super(e),this.addClass("input-list");const t=new UIButton({text:"+",callback:()=>{this.list.push(""),this.addItem(this.list.length-1,0),this.callback(this.list)}});this.append(t),this.addItems()}addItem(e,t){const s=new UIText({value:t,callback:t=>{this.list[e]=t,this.callback&&this.callback(this.list)}});this.append(s,"n"+e)}}UI.Elements.UIInputList=UIInputList;class UIInput extends UIElement{constructor(e){e.tag="input",super(e),this.callback=e.callback,this.args=e.args||[],e.key&&this.setKey(e.key,e.label),e.value&&(this.value=e.value)}}UI.Elements.UIInput=UIInput;class UIText extends UIInput{constructor(e){super(e),this.el.type="text",this.placeholder=this.el.placeholder||e.placeholder||e.text||e.value||"",this.el.placeholder=this.placeholder,this.el.addEventListener("focus",(e=>{this.el.select()})),this.el.addEventListener("keyup",(e=>{13==e.which&&(this.update(e.target.value),this.el.blur())})),this.el.addEventListener("blur",(e=>{this.value?this.value!=e.target.value&&e.target.value&&this.update(e.target.value):(this.el.placeholder=this.placeholder,this.el.value="")}))}keyHandler(e){this.update(prompt(this.prompt))}update(e,t){this.value=e,this.callback&&!t&&this.callback(e)}set value(e){this._value=e,this.placeholder=e,this.el.placeholder=e,this.el.value=""}get value(){return this._value||this.placeholder}}function Interface(e,t){document.body.classList.add(Cool.mobilecheck()?"mobile":"desktop");const s={},i={},a={};let l,n,o;function r(e){let t=e[0].toUpperCase()+e.substring(1);return t=t.replace(/(?<=[a-z])(?=[A-Z])/g," "),t}function c(e,t){return"string"==typeof e?"UIText":"number"==typeof e?"UINumber":"boolean"==typeof e?"UIToggle":void 0}function h(e,t={}){if(!e)return o;if(a[e])return a[e];const s=t.label||r(e),i=new UIPanel({id:e,label:s});return a[e]=i,n.addSelectOption(e,s),i!==o&&(o=i),i}function d(e,t){t||(t=o),t.isPanel||(t=h(t)),e.row&&t.addRow(),e.label&&t.add(new UILabel({text:e.label}));const i=new UI.Elements[e.type||"UIButton"](e);return t.add(i,e.k),e.key&&(s[e.key]=i),l.registerCallback(r(t.id),r(e.text||e.label),e),i}function u(e,t,a){a||(a=o),a.isPanel||(a=h(a));const n=t.type||c(t.value),d=new UI.Elements[n](t);return a.addRow(),t.noLabel||a.add(new UILabel({text:t.label||r(e),class:"prop"})),a.add(d),"bpm"===e&&console.trace(),i[e]=d,t.key&&(s[t.key]=d),t.reset&&a.add(new UIButton({text:"Reset",callback:()=>{d.update(t.value)}})),l.registerProp(e,r(a.id),r(e),t),d}function p(e,t){t||(t=o),t.isPanel||(t=h(t)),e.row&&t.addRow();const a=e.type||c(e.value);e.label&&t.add(new UILabel({text:e.label||r(prop),class:"prop"}));let l=new UI.Elements[a](e);return t.add(l,void 0,e.k),e.key&&(s[e.key]=l),e.face&&(i[e.face]=l,l.ignoreSettings=!0),l}return document.addEventListener("keydown",(function(e){let t=Cool.keys[e.which];"space"===t&&e.preventDefault(),t=e.shiftKey?"shift-"+t:t,t=e.ctrlKey?"ctrl-"+t:t,t=e.altKey?"alt-"+t:t,t&&s[t]&&"text"!==document.activeElement.type&&"number"!==document.activeElement.type&&(e.metaKey||(e.preventDefault(),s[t].keyHandler(e.target.value),s[t].onPress(!0)))}),!1),window.ToolTip=new UILabel({id:"tool-tip"}),{keys:s,faces:i,panels:a,getLayout:function(){return n},getQuickRef:function(){return l},setup:function(){n=new Layout(e,t),l=new QuickRef(e),n.connect(),l.connect()},getPanel:h,addCallback:d,addCallbacks:function(e,t){e.forEach((e=>{d(e,t)}))},addProp:u,addProps:function(e,t){for(const s in e)u(s,e[s],t)},addUI:p,addUIs:function(e,t){if(Array.isArray(e))e.forEach((e=>{p(e,t)}));else for(const s in e){p({...e[s],face:s,row:!0},t)}}}}function Layout(e,t){const s=new UICollection({id:"container"}),i=new UISection({id:"ui",gridArea:"default",addPanelToSection:n});s.append(i);const a=new UISection({id:"ui-timeline",gridArea:"timeline",addPanelToSection:n});s.append(a);const l=new UISection({id:"main",gridArea:"main",addPanelToSection:n});function n(t,s,i){const a=e.ui.panels[t];s.panels.append(a),a.gridArea=i,a.dock()}return i.append(ToolTip),{default:i,timeline:a,main:l,container:s,connect:function(){e.ui.addProps({timelineLayout:{type:"UIToggleCheck",value:!0,label:"Timeline",callback:e=>{a.isVisible=e}},rightLayout:{type:"UIToggleCheck",value:!1,label:"▶/◀",callback:e=>{e?s.addClass("RL"):s.removeClass("RL")}},upLayout:{type:"UIToggleCheck",value:!1,label:"▼/▲",callback:e=>{e?s.addClass("UP"):s.removeClass("UP")}}},"layout")},addSelectPanels:function(e){i.addSelectorOptions(e),a.addSelectorOptions(e),l.addSelectorOptions(e)},addSelectOption:function(e,t){i.addSelectorOption(e,t),a.addSelectorOption(e,t),l.addSelectorOption(e,t)},getSettings:function(){return{default:i.settings,timeline:a.settings,main:l.settings}}}}function QuickRef(e){const t=[],s=[],i=[];let a;function l(){const s=new UIModal({title:"Add UI To Quick Ref",app:e,position:e.ui.panels.quick.position});const i=new UIInputSearch({listName:"quick-menu-list",options:t.map((e=>e.label)),escape:()=>{s.clear()},callback:e=>{s.clear(),function(e){const{type:s,params:i,prop:l}=t.find((t=>t.label===e));i.label=e;let n,o=a.addRow();n="prop"===s?new UI.Elements[i.type](i):new UIButton(i),o.append(new UILabel({text:e,css:{"margin-right":"auto"}})),o.append(n),o.append(new UIButton({text:"x",callback:()=>{a.removeRow(o)}}))}(e)}});s.add(i),i.focus()}function n(){const s=new UIModal({title:"Quick Menu",app:e,position:{x:window.innerWidth/2,y:window.innerHeight/2}});const i=new UIInputSearch({listName:"quick-menu-list",options:t.map((e=>e.label)),escape:()=>{s.clear()},callback:i=>{s.clear(),function(s){const i=t.find((e=>e.label===s));i&&("prop"===i.type?e.ui.faces[i.prop].update():i.params.callback())}(i)}});s.add(i),i.focus()}function o(){const t=new UIModal({title:"Key Commands",app:e,class:"key-command-list",position:{x:200,y:120}});for(let e=0;e<s.length;e++){const i=s[e];t.add(new UILabel({text:i.key+" --\x3e "+i.label,class:"break"}))}}return{connect:function(){a=e.ui.getPanel("quick",{label:"Quick Ref"}),e.ui.addCallbacks([{callback:n,text:"Menu",key:"ctrl-space"},{callback:l,text:"+"},{callback:o,text:"Key Commands",key:"ctrl-,"}]),e.ui.addProp("quickRefScale",{type:"UINumberStep",value:11,label:"Scale",callback:e=>{document.body.style.setProperty("--quick-ref-font-size",+e)},reset:!0,range:[10,40]})},registerCallback:function(e,i,a){t.push({label:`${e} > ${i}`,params:a,type:"callback"}),a.key&&s.push({key:a.key,label:`${e} > ${i}`})},registerProp:function(e,i,a,l){t.push({label:`${i} > ${a}`,prop:e,params:l,type:"prop"}),l.key&&s.push({key:l.key,label:`${i} > ${a}`})},getList:()=>i}}function Settings(e,t){let{name:s,workspaceFields:i,workspaces:a,appLoad:l,appSave:n}=t;const o=`settings-${s}`;function r(t){const s=e.ui.getLayout();for(const i in t){if("el"===i)continue;if(!e.ui.panels[i])continue;e.ui.panels[i].setup(t[i]);let a=e.ui.panels[i];t[i];s[a.gridArea||"default"].panels.append(a)}}function c(t){for(const s in t)"palettes"!==s&&"quickRef"!==s&&e.ui.faces[s]&&e.ui.faces[s].update(t[s])}function h(t){for(const s in t)e.ui.getLayout()[s].maxWidth.update(t[s].maxWidth),e.ui.getLayout()[s].maxWidthToggle.update(t[s].maxWidthToggle),void 0!==t[s].isVisible&&(e.ui.getLayout()[s].isVisible=t[s].isVisible)}function d(){const t={},s={};Object.keys(e.ui.faces).filter((t=>!e.ui.faces[t].ignoreSettings)).forEach((t=>{s[t]=e.ui.faces[t].value})),n&&Object.assign(s,n()),t.interface=s,t.panels={};for(const s in e.ui.panels)"el"!==s&&(t.panels[s]=e.ui.panels[s].settings);t.layout=e.ui.getLayout().getSettings(),t.quickRef=e.ui.getQuickRef().getList(),localStorage[o]=JSON.stringify(t)}function u(){if(localStorage[o]){const t=JSON.parse(localStorage[o]);r(t.panels),c(t.interface),h(t.layout),t.quickRef&&(e.ui.getQuickRef().list=t.quickRef,t.quickRef.forEach((e=>{console.log(e)}))),l&&l(t)}else a.length>0&&p(a[0].url)}function p(e){if(e)fetch(e).then((e=>e.json())).then((e=>{c(e.interface),r(e.panels),h(e.layout)})).catch((e=>{console.error(e)}));else{const e=document.createElement("input");e.type="file",e.click(),e.onchange=function(){for(let t,s=0;t=e.files[s];s++){if(!t.type.match("application/json"))continue;const e=new FileReader;e.onload=function(e){const t=JSON.parse(e.target.result);r(t.panels),c(t.interface),h(t.layout)},e.readAsText(t)}}}}return i||(i=[]),i=[...i,"timelineLayout","rightLayout","upLayout"],e.ui.addCallbacks([{callback:d,key:"ctrl-s",text:"Save"},{callback:u,text:"Load"},{callback:function(){localStorage.setItem(o,"")},text:"Clear"}],"settings"),e.ui.addCallbacks([{callback:function(){d();const t={};i.filter((t=>e.ui.faces[t])).forEach((s=>{t[s]=e.ui.faces[s].value}));const s=JSON.parse(localStorage.getItem(o)),a=JSON.stringify({panels:s.panels,layout:s.layout,interface:t}),l=prompt("Layout Name:","New Layout"),n=new Blob([a],{type:"application/x-download;charset=utf-8"});saveAs(n,`${l}.json`)},key:"alt-w",text:"Save"},{callback:p,text:"Load"}],"workspaces"),e.ui.addUI({row:!0,type:"UILabel",text:"Defaults",class:"break"},"workspaces"),a.forEach((t=>{const{text:s,url:i}=t;e.ui.addCallback({text:s,callback:()=>{p(i)}},"workspaces")})),{load:u}}UI.Elements.UIText=UIText,UI.Interface=Interface,UI.Settings=Settings;class UIButton extends UIElement{constructor(e){e.tag="button",super(e),this.addClass(e.btnClass||"btn"),this.text=this.el.textContent||e.text||e.onText,this.callback=e.callback,this.args=e.args||[],this.el.addEventListener("click",this.keyHandler.bind(this)),e.key&&this.setKey(e.key,`${this.el.textContent}`)}keyHandler(){this.callback(...this.args)}}UI.Elements.UIButton=UIButton;class UIColor extends UIInput{constructor(e){super(e),this.el.type="color",this.colors=[],this.args=e.args||[],this.el.addEventListener("input",(e=>{this.setColor(e.target.value)})),this.el.addEventListener("focus",(e=>{this.addColor(this.current)})),this.palette=new UICollection}addColor(e){const t=this;if(this.colors&&!this.colors.includes(e)&&e){this.colors.push(e);const s=new UIButton({text:e,css:{background:e},value:e,callback:function(){t.update(e)}});t.palette.append(s)}}setColor(e){this.current=e,this.callback(e,...this.args)}update(e,t){t||this.setColor(e),this.value=e}set value(e){this.addColor(e),this.current=e,super.value=e}get value(){return this.el.value}get html(){return[this.el,this.palette.el]}}UI.Elements.UIColor=UIColor;class UIDrag extends UIText{constructor(e){super(e),this.addClass("drag");const t={x:0,y:0,timeout:5,timer:0,prev:0,active:!1};function s(s){if(!t.active)return;const i={x:s.pageX-t.x,y:s.pageY-t.y},a=Math.abs(i.x)>Math.abs(i.y)?"x":"y";if(Math.abs(i[a])>10&&0===t.timer){const l="x"===a?1:-1;e.drag&&e.drag(l*Math.sign(i[a])),t.timer=t.timeout,t.x=s.pageX,t.y=s.pageY}else t.timer>0&&t.timer--}function i(e){t.active&&(t.active=!1,t.x=0,t.y=0,document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",i))}this.el.addEventListener("mousedown",(function(e){t.x=e.pageX,t.y=e.pageY,t.active=!0,document.addEventListener("mousemove",s),document.addEventListener("mouseup",i)})),void 0!==e.value&&(this.value=e.value)}}UI.Elements.UIDrag=UIDrag;class UIDragButton extends UIButton{constructor(e){super(e),this.down={x:0,y:0},this.el.addEventListener("mousemove",(e=>{this.down.x&&(this.dragging=!0)})),this.el.addEventListener("mousedown",(e=>{this.down.x=e.pageX})),document.addEventListener("mouseup",(e=>{if(this.dragging){const t=e.pageX-this.down.x;Math.abs(t)>10&&this.callback(t>0?1:-1,Math.abs(Math.ceil(t/lns.timeline.frameWidth)))}this.dragging=!1,this.down.x=0}))}}UI.Elements.UIDragButton=UIDragButton;class UIFile extends UIButton{constructor(e){super(e),this.multiple=e.multiple||!1,this.promptDefault=e.promptDefault,this.fileType=e.fileType||"application/json"}keyHandler(){const{callback:e,promptDefault:t,multiple:s,fileType:i}=this;const a=document.createElement("input");a.type="file",a.multiple=s,a.click(),a.onchange=function(){let s=prompt("Directory?",t);!function(t,s){for(let a,l=0;a=t[l];l++){if(!a.type.match(i))continue;const t=new FileReader;t.onload=function(t){const l="/"+s+"/"+a.name,n=a.name.split(".")[0];let o;o="application/json"===i?JSON.parse(t.target.result):t.target.result,e(o,n,l)},t.readAsText(a)}}(a.files,s)}}}UI.Elements.UIFile=UIFile;class UIInputSearch extends UICollection{constructor(e){super(e);const t=new UIElement({tag:"input",class:"search"});function s(s){t.el.blur(),e.callback&&e.callback(this.value)}t.el.setAttribute("list",e.listName),t.el.addEventListener("change",s),e.escape&&t.el.addEventListener("keydown",(i=>{"escape"===Cool.keys[i.which]&&(t.el.removeEventListener("change",s),e.escape())}));const i=new UIElement({tag:"datalist",id:e.listName});this.append(t,"input"),this.append(i,"list"),this.setOptions(e.options||[])}focus(){this.input.el.focus()}get value(){return this.input.el.value}set value(e){this.input.value=e}addOption(e,t){const s=document.createElement("option");s.value=s.textContent=e,t&&(s.textContent=t),this.list.el.appendChild(s)}setOptions(e){for(let t=0;t<e.length;t++){Array.from(this.list.el.options).map((e=>e.value)).includes(e[t])||this.addOption(e[t])}}}UI.Elements.UIInputSearch=UIInputSearch;class UILabel extends UIElement{constructor(e){e.tag="label",super(e),this.text=e.text}}UI.Elements.UILabel=UILabel;class UIList extends UICollection{constructor(e){super(e)}insertBefore(e,t){this.el.insertBefore(e.el,t.el)}get length(){return this.el.children.length}get children(){return this.el.children}addClass(e){for(let t=0;t<this.els.length;t++)this.els[t].classList.contains(e)||this.els[t].classList.add(e)}setId(e,t){this.children[t].id=e}removeIndex(e){this.children[e].remove()}looper(e,t,s){const i=s||this.length-2;for(let s=t||0;s<=i;s++)e(this.children[s])}}UI.Elements.UIList=UIList;class UIListStep extends UICollection{constructor(e){super(e),this.addClass("list-step"),this.addClass("ui-collection"),this.list=e.list,this.index=void 0!==e.value?e.list.indexOf(e.value):0,e.callback&&(this.callback=e.callback),this.textInput=new UIDrag({value:e.value,class:"left-end",drag:e=>{this.index+e>=0&&this.index+e<this.list.length&&(this.index+=e),this.update(this.list[this.index])},callback:e=>{this.update(this.value)}});const t=new UIButton({text:"▼",class:"middle",callback:()=>{this.index>0&&(this.index-=1),this.update(this.list[this.index])}}),s=new UIButton({text:"▲",class:"right-end",callback:()=>{this.index<this.list.length-1&&(this.index+=1),this.update(this.list[this.index])}});this.append(this.textInput),this.append(t),this.append(s)}update(e,t){this.list.includes(e)&&(this.value=e,!t&&this.callback&&(this.args?this.callback(e,...this.args):this.callback(e)))}set value(e){this.list.includes(e)&&(this.index=this.list.indexOf(e),this.textInput.value=e)}get value(){return this.textInput.value}}UI.Elements.UIListStep=UIListStep;class UIModal extends UICollection{constructor(e){super({}),e.callback&&(this.callback=e.callback),this.addClass("modal"),e.class&&this.addClass(e.class),this.append(new UILabel({text:e.title})),document.getElementById("container").appendChild(this.el);const t=this;this.break=new UIElement({class:"break"}),this.append(this.break),this.submit=new UIButton({text:"Submit",callback:function(){e.callback&&e.callback(),t.clear()}}),this.append(this.submit),e.app.ui.keys.enter=this.submit,this.cancel=new UIButton({text:"x",callback:t=>{this.clear(),e.onClear&&e.onClear()}}),e.app.ui.keys.escape=this.cancel,this.append(this.cancel);let s=Math.max(16,e.position.x-100),i=Math.max(16,e.position.y-20);this.el.style.left=`${s}px`,this.el.style.top=`${i}px`}adjustPosition(){let e=parseInt(this.el.style.left),t=parseInt(this.el.style.top),s=parseInt(this.el.clientWidth),i=parseInt(this.el.clientHeight);e+s>window.innerWidth&&(this.el.style.left=window.innerWidth-s-20+"px"),t+i>window.innerHeight&&(this.el.style.top=window.innerHeight-i-20+"px")}add(e){Array.isArray(e.html)?e.html.forEach((e=>{this.el.insertBefore(e,this.break.el)})):this.el.insertBefore(e.el,this.break.el),this.adjustPosition()}addBreak(e){this.add(new UIElement({class:"break"})),e&&this.addLabel(e),this.adjustPosition()}addLabel(e){this.add(new UILabel({text:e})),this.adjustPosition()}clear(){this.el.remove()}}UI.Elements.UIModal=UIModal;class UINumber extends UIText{constructor(e){super(e),this.el.classList.add("number"),this.placeholder||(this.placeholder=0,this.el.placeholder=0)}update(value,uiOnly){if(void 0!==value){if("string"==typeof value&&value.match(/\D/))try{value=eval(value)}catch(e){return void alert("Please enter a numerical value or mathematical expression.")}"string"==typeof value&&(value=+value),this.value=value,this.callback&&!uiOnly&&this.callback(value)}}keyHandler(e){this.update(+prompt(this.prompt))}}UI.Elements.UINumber=UINumber;class UINumberList extends UIListAdd{constructor(e){super(e),this.addClass("number-list");const t=new UIButton({text:"+",callback:()=>{this.list.push(0),this.addItem(this.list.length-1,0),this.callback(this.list)}});this.append(t),this.addItems()}addItem(e,t){const s=new UINumberStep({value:t,callback:t=>{this.list[e]=+t,this.callback&&this.callback(this.list)}});this.append(s,"n"+e)}}UI.Elements.UINumberList=UINumberList;class UINumberRange extends UICollection{constructor(e){super(e),this.callback=e.callback,this.args=e.args||[],this.numberInput=new UINumber({...e,callback:this.update.bind(this)}),this.range=new UIRange({...e,callback:this.update.bind(this)}),"change"===e.event&&this.range.el.addEventListener("input",(e=>{this.numberInput.el.placeholder=e.currentTarget.value})),void 0!==e.value&&(this.value=e.value)}get html(){return[this.numberInput.el,this.range.el]}keyHandler(e){this.update(+prompt(this.prompt))}update(e,t){t||this.callback(+e,...this.args),this.value=e}set value(e){this.numberInput.value=e,this.range.value=e}get value(){return+this.numberInput.value}}UI.Elements.UINumberRange=UINumberRange;class UINumberStep extends UICollection{constructor(params){super(params),this.addClass("number-step"),this.addClass("ui-collection"),this.prompt=params.prompt,this.callback=params.callback,this.args=params.args,this.step=+params.step||1,this.min=params.range?+params.range[0]:+params.min||0,this.max=params.range?+params.range[1]:+params.max||1e3,this.numberInput=new UIDrag({...params,class:"middle",drag:e=>{this.update(this.value+this.step*e)},callback:value=>{if("string"==typeof value&&value.match(/\D/))try{value=eval(value)}catch(e){return void alert("Please enter a numerical value or mathematical expression.")}this.update(+value)}}),this.stepDown=new UIButton({text:"◀",class:"left-end",callback:()=>{this.update(this.value-this.step)}}),this.stepUp=new UIButton({text:"▶",class:"right-end",callback:()=>{this.update(this.value+this.step)}}),this.append(this.stepDown),this.append(this.numberInput),this.append(this.stepUp)}keyHandler(e){this.update(+prompt(this.prompt))}update(e,t){if(void 0===e&&(e=prompt(this.prompt)),null==e||""===e)return console.trace(),alert("No value entered.");(e=+e)<this.min&&(e=this.min),e>this.max&&(e=this.max),this.value=e,t||(this.args?this.callback(e,...this.args):this.callback&&this.callback(e))}get html(){return this.el}set value(e){this.numberInput.value=+e}get value(){return this.numberInput.value}}UI.Elements.UINumberStep=UINumberStep;class UIPanel extends UICollection{constructor(e){super({id:`${e.id}-panel`}),this.id=e.id,this.isPanel=!0,this.addClass("panel"),this.addClass("undocked"),this.gridArea="default",this.rows=[],this.header=new UIRow,this.header.addClass("header"),this.append(this.header),this.open=new UIToggle({onText:"－",offText:"＋",class:"toggle",isOn:!0,callback:e=>{e?this.removeClass("closed"):this.addClass("closed")}}),this.header.append(this.open),this.header.append(new UILabel({text:e.label})),this.header.append(new UIButton({text:"X",class:"undock-btn",callback:this.undock.bind(this)})),this.orderBtn=new UIButton({text:this.order||"0",class:"order-btn",callback:()=>{this.order=+this.el.style.order+1,this.orderBtn.text=this.order}}),this.header.append(this.orderBtn),this.header.append(new UIButton({text:"[]",class:"block-btn",callback:()=>{this.el.classList.contains("block")?this.el.classList.remove("block"):this.el.classList.add("block")}})),this.header.append(new UIButton({text:"<",class:"headless-btn",callback:()=>{this.el.classList.contains("headless")?this.el.classList.remove("headless"):this.el.classList.add("headless")}}))}set order(e){this.orderBtn.text=e||"0",this.el.style.order=e}get order(){return this.el.style.order}get isDocked(){return!this.el.classList.contains("undocked")}get isBlock(){return this.el.classList.contains("block")}get isHeadless(){return this.el.classList.contains("headless")}get isOpen(){return this.open.value}get settings(){return{open:this.isOpen,docked:this.isDocked,order:this.order,block:this.isBlock,headless:this.isHeadless,gridArea:this.gridArea}}get lastRow(){return 0===this.rows.length?this.addRow():this.rows[this.rows.length-1]}close(){this.addClass("closed"),this.open.set(!1)}block(){this.el.classList.add("block")}headless(){this.el.classList.add("headless")}dock(){this.removeClass("undocked")}undock(){this.addClass("undocked")}addRow(e,t){const s=new UIRow({id:e,class:t});return this.append(s,e),this.rows.push(s),s}removeRow(e){const t=this.rows.indexOf(e);this.rows.splice(t,1),this.remove(e)}add(e,t,s){return(s||this.rows[this.rows.length-1]||this.addRow()).append(e,t),e}setup(e){e.docked?this.dock():this.undock(),e.open||this.close(),e.block&&this.block(),e.headless&&this.headless(),this.order=e.order,this.gridArea=e.gridArea}}UI.Elements.UIPanel=UIPanel;class UIRange extends UIInput{constructor(e){super(e),this.el.type="range";const[t,s]=e.range?[...e.range]:[e.min,e.max];this.setRange(t,s),this.value=e.value||e.min,e.step&&this.setStep(e.step),this.el.addEventListener(e.event||"input",(e=>{this.update(e.target.value)}))}keyHandler(e){this.update(+prompt(this.prompt))}update(e){this.el.value=e,this.el.blur(),this.callback(e)}setRange(e,t){this.el.min=e,this.el.max=t}setStep(e){this.el.step=e}}UI.Elements.UIRange=UIRange;class UIRow extends UICollection{constructor(e){super(e),this.addClass("row"),this.uiChildren=[],this.keys=[]}append(e,t){return super.append(e,t),t&&this.keys.push(t),this.uiChildren.push(e),e}insert(e,t){super.insert(e,t);const s=this.uiChildren.indexOf(t);this.uiChildren.splice(s,0,e)}clear(){for(const e in this.keys)delete this[e];for(this.keys=[];this.el.firstChild;)this.el.firstChild.value=null,this.el.removeChild(this.el.firstChild);this.uiChildren=[]}remove(e,t){super.remove(e,t);let s=this.uiChildren.indexOf(e);return this.uiChildren.splice(s,1),e}pop(){let e=this.uiChildren.pop();if(e)return super.remove(e),e}addBreak(){this.add(new UIElement({class:"break"}))}get children(){return this.uiChildren}}UI.Elements.UIRow=UIRow;class UISection extends UICollection{constructor(e){super(e),this.addClass("ui-section"),this.panels=new UICollection({id:e.id+"-panels",class:"panels"}),this.panels.append(new UIElement({class:"break"}));const t=new UICollection({id:e.id+"-header",class:"section-header"});this.selector=new UISelectButton({class:"selector",callback:t=>{e.addPanelToSection(t,this,e.gridArea)}}),t.append(this.selector),this.append(t),this.append(this.panels);const s=new UICollection({class:"width-collection"});t.append(s),s.append(new UILabel({text:"Width"})),this.maxWidth=new UINumber({value:500,callback:e=>{this.setProp("--max-width",e)}}),s.append(this.maxWidth),this.maxWidthToggle=new UIToggleCheck({callback:e=>{e?this.addClass("max-width"):this.removeClass("max-width")}}),s.append(this.maxWidthToggle),this._isVisible=!0;const i=new UICollection({class:"scale-collection"});t.append(i),i.append(new UILabel({text:"Scale"})),this.baseFontSize=new UINumberStep({value:11,min:10,max:40,callback:e=>{this.panels.setProp("--ui-scale",+e)}}),i.append(this.baseFontSize)}addSelectorOptions(e){e.forEach((e=>{const[t,s]=e;this.selector.select.addOption(t,s)}))}addSelectorOption(e,t){this.selector.select.addOption(e,t)}get isVisible(){return this._isVisible}set isVisible(e){this._isVisible=e,e?this.removeClass("hidden"):this.addClass("hidden")}get settings(){return{maxWidthToggle:this.maxWidthToggle.value,maxWidth:this.maxWidth.value,isVisible:this.isVisible,baseFontSize:this.baseFontSize.value}}}UI.Elements.UISection=UISection;class UISelect extends UIElement{constructor(e){e.tag="select",super(e),e.callback&&(this.callback=e.callback),this.setOptions(e.options||[]),e.selected&&(this.value=e.selected),e.value&&(this.value=e.value),this.el.addEventListener("change",(t=>{e.callback&&e.callback(t.target.value),t.target.blur()}))}get options(){return Array.from(this.el.options).map((e=>e.value))}update(e){this.options.includes(e)||this.addOption(e),this.value=e,this.callback&&this.callback(e)}removeOption(e){for(let t=0;t<this.el.children.length;t++)this.el.children[t].value==e&&this.el.children[t].remove()}addOption(e,t){const s=document.createElement("option");s.value=s.textContent=e,t&&(s.textContent=t),this.el.appendChild(s)}setOptions(e){for(let t=0;t<e.length;t++){const s=Array.from(this.el.options).map((e=>e.value)),{value:i,text:a}="string"==typeof e[t]?{value:e[t]}:e[t];s.includes(i)||this.addOption(i,a)}}}UI.Elements.UISelect=UISelect;class UISelectButton extends UICollection{constructor(e){super(e),e.callback&&(this.callback=e.callback),this.addClass("ui-collection");const t=new UISelect({options:e.options,callback:function(){}}),s=new UIButton({text:"+",css:{"margin-left":"1px"},callback:()=>{this.callback&&this.callback(t.value)}});this.append(t,"select"),this.append(s),e.btns&&e.btns.forEach((e=>{const s=new UIButton({text:e.text,css:{"margin-left":"1px"},callback:()=>{e.callback(t.value)}});this.append(s)}))}}UI.Elements.UISelectButton=UISelectButton;class UIToggle extends UIButton{constructor(e){super(e),this.onText=e.onText||e.text,this.offText=e.offText||e.text,this.isOn=e.isOn||e.value||!1,this.isOn&&this.on(),super.text=this.isOn?this.onText:this.offText,this.addClass("toggle")}update(e,t){e!==this.isOn&&(void 0===this.isOn&&(this.isOn=e),t||this.callback(e),this.set(e))}keyHandler(){this.set(!this.isOn),this.callback(this.value)}set(e){this.isOn=e,e?this.on():this.off()}toggle(){this.isOn=!this.isOn,this.isOn?this.on():this.off()}on(){this.text=this.onText,this.addClass("on")}off(){this.text=this.offText,this.removeClass("on")}get value(){return this.isOn}}UI.Elements.UIToggle=UIToggle;class UIToggleCheck extends UICollection{constructor(e){super(e),this.callback=e.callback,this.addClass("ui-collection"),this.check=new UIElement({tag:"input",class:"toggle-check"}),this.check.el.type="checkbox",this.check.el.checked=e.isOn||e.value||!1,this.check.el.addEventListener("change",(e=>{this.callback&&this.callback(e.target.checked),this.check.el.blur()})),this.el.appendChild(this.check.el)}get value(){return this.check.el.checked}keyHandler(e){this.update(void 0!==e?e:!this.value)}update(e){void 0===e&&(e=!this.value),this.check.el.checked=e,this.callback&&this.callback(e)}}UI.Elements.UIToggleCheck=UIToggleCheck;class UIToggleGrid extends UICollection{constructor(e){super(e),this.callback=e.callback,this.value=e.value,this.addClass("ui-collection");new UILabel({text:e.text??"Grid"});const t=new UIButton({text:"-",class:"left-end",callback:()=>{for(let e=0;e<this.value.length;e++)this.value[e].pop();this.updateGrid()}}),s=new UIButton({text:"+",class:"right-end",callback:()=>{for(let e=0;e<this.value.length;e++)this.value[e].push(!0);this.updateGrid()}});this.grid=new UICollection({id:"sequence-grid"}),this.add(t),this.add(s),this.add(this.grid),this.updateGrid()}updateGrid(){this.grid.clear(),this.grid.setProp("--rows",this.value.length),this.grid.setProp("--cols",this.value[0].length);for(let e=0;e<this.value.length;e++)for(let t=0;t<this.value[e].length;t++){const s=new UIToggleCheck({value:this.value[e][t],css:{"grid-row":`${e+1}/${e+1}`,"grid-column":`${t+1}/${t+1}`},callback:s=>{this.value[e][t]=s,this.callback(this.value)}});this.grid.add(s)}}update(e){this.value=e,this.updateGrid()}}UI.Elements.UIToggleGrid=UIToggleGrid;class UITree extends UICollection{constructor(e){e.tag="details",super(e),this.addClass("tree"),this.addClass("row");const t=new UIElement({tag:"summary",text:e.title});this.el.appendChild(t.el),this.row=new UIRow,this.el.appendChild(this.row.el)}addRow(e,t){this.append(e),void 0!==t&&(this[t]=e)}add(e,t){this.row.add(e),void 0!==t&&(this[t]=e)}removeK(e){this.row.el.removeChild(this[e].el),delete this[e]}clear(){this.row.clear()}addBreak(){this.row.addBreak()}}UI.Elements.UITree=UITree;class UIChance extends UICollection{constructor(e){super(e),this.addClass("value-bg"),this.step=e.step,this.min=e.min,this.max=e.max,this.value=e.value,this.total=e.max-e.min,e.callback&&(this.callback=e.callback),this.drag=new UIDrag({value:e.value,drag:e=>{this.update(this.value+this.step*e*10)},callback:e=>{this.update(+e)}});const t=new UILabel({text:e.label});this.append(t),this.append(this.drag),this.setProp("--value-percent",Math.round((this.value-this.min)/this.total*100))}update(e,t){e<this.min&&(e=this.min),e>this.max&&(e=this.max),this.value=+e.toFixed(3),this.drag.value=this.value,this.setProp("--value-percent",Math.round((this.value-this.min)/this.total*100)),t||(this.args?this.callback(e,...this.args):this.callback(e))}}UI.Elements.UIChance=UIChance})();
//# sourceMappingURL=src_maps/ui.min.js.map
