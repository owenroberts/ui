(function(){"use strict";window.UI={Elements:{}};class UIElement{constructor(e){e=e||{},this.el=document.getElementById(e.id)?document.getElementById(e.id):document.createElement(e.tag||"div");for(const t in e.css)this.el.style[t]=e.css[t];void 0!==e.id&&(this.el.id=e.id),e.class&&this.addClass(e.class),e.text&&(this.el.textContent=e.text)}set text(e){this.el.textContent=e}set value(e){this.el.value=e}get value(){return this.el.value}get position(){return{x:this.el.getBoundingClientRect().x,y:this.el.getBoundingClientRect().y}}getPosition(){return{x:this.el.getBoundingClientRect().x,y:this.el.getBoundingClientRect().y}}setProp(e,t){this.el.style.setProperty(e,t)}getProp(e){return this.el.style.getPropertyValue(e)}keyHandler(){this.callback()}addClass(e){this.el.classList.add(e)}removeClass(e){this.el.classList.remove(e)}setKey(e,t){this.el.title=`${t||""} ~ ${e}`,this.el.addEventListener("mouseenter",this.onPress.bind(this)),this.el.addEventListener("mouseleave",this.onRelease.bind(this))}onPress(e){ToolTip.text=`${this.el.title}`,ToolTip.addClass("visible"),this.addClass("triggered"),!0===e&&setTimeout(this.onRelease.bind(this),400)}onRelease(){ToolTip.removeClass("visible"),this.removeClass("triggered")}remove(){this.el.remove()}}UI.Elements.UIElement=UIElement;class UICollection extends UIElement{constructor(e){super(e)}append(e,t){void 0!==t&&(this[t]=e),Array.isArray(e.html)?e.html.forEach((e=>{this.el.appendChild(e)})):this.el.appendChild(e.el)}add(e,t){this.append(e,t)}remove(e,t){t&&delete this[t],this.el.removeChild(e.el)}removeK(e){this.el.removeChild(this[e].el),delete this[e]}clear(){for(let e=this.el.children.length-1;e>=0;--e)this.el.children[e].remove()}get uiList(){return Object.keys(this).filter((e=>"el"!==e)).map((e=>this[e]))}}UI.Elements.UICollection=UICollection;class UIInput extends UIElement{constructor(e){e.tag="input",super(e),this.callback=e.callback,this.args=e.args||[],e.key&&this.setKey(e.key,e.label)}}UI.Elements.UIInput=UIInput;class UIText extends UIInput{constructor(e){super(e),this.el.type="text",this.placeholder=this.el.placeholder||e.placeholder||e.text||e.value||"",this.el.placeholder=this.placeholder,this.el.addEventListener("focus",(e=>{this.el.select()})),this.el.addEventListener("keyup",(e=>{13==e.which&&(this.update(e.target.value),this.el.blur())})),this.el.addEventListener("blur",(e=>{this.value?this.value!=e.target.value&&e.target.value&&this.update(e.target.value):(this.el.placeholder=this.placeholder,this.el.value="")}))}keyHandler(e){this.update(prompt(this.prompt))}update(e,t){this.value=e,this.callback&&!t&&this.callback(e)}set value(e){this._value=e,this.placeholder=e,this.el.placeholder=e,this.el.value=""}get value(){return this._value||this.placeholder}}function Interface(e,t){document.body.classList.add(Cool.mobilecheck()?"mobile":"desktop");const s={},a={},l={};let i,n,o;function c(e){let t=e[0].toUpperCase()+e.substring(1);return t=t.replace(/(?<=[a-z])(?=[A-Z])/g," "),t}function r(e,t){return"string"==typeof e?"UIText":"number"==typeof e?"UINumber":"boolean"==typeof e?"UIToggle":void 0}function h(e,t={}){if(!e)return o;if(l[e])return l[e];const s=t.label||c(e),a=new UIPanel({id:e,label:s});return l[e]=a,n.addSelectOption(e,s),a!==o&&(o=a),a}function d(e,t){t||(t=o),t.isPanel||(t=h(t)),e.row&&t.addRow(),e.label&&t.add(new UILabel({text:e.label}));const a=new UI.Elements[e.type||"UIButton"](e);return t.add(a,e.k),e.key&&(s[e.key]=a),i.registerCallback(c(t.id),c(e.text||e.label),e),a}function u(e,t,l){l||(l=o),l.isPanel||(l=h(l));const n=t.type||r(t.value),d=new UI.Elements[n](t);return l.addRow(),t.noLabel||l.add(new UILabel({text:t.label||c(e),class:"prop"})),l.add(d),"bpm"===e&&console.trace(),a[e]=d,t.key&&(s[t.key]=d),t.reset&&l.add(new UIButton({text:"Reset",callback:()=>{d.update(t.value)}})),i.registerProp(e,c(l.id),c(e),t),d}function p(e,t){t||(t=o),t.isPanel||(t=h(t)),e.row&&t.addRow();const l=e.type||r(e.value);e.label&&t.add(new UILabel({text:e.label||c(prop),class:"prop"}));let i=new UI.Elements[l](e);return t.add(i,void 0,e.k),e.key&&(s[e.key]=i),e.face&&(a[e.face]=i,i.ignoreSettings=!0),i}return document.addEventListener("keydown",(function(e){let t=Cool.keys[e.which];"space"===t&&e.preventDefault(),t=e.shiftKey?"shift-"+t:t,t=e.ctrlKey?"ctrl-"+t:t,t=e.altKey?"alt-"+t:t,t&&s[t]&&"text"!==document.activeElement.type&&"number"!==document.activeElement.type&&(e.metaKey||(e.preventDefault(),s[t].keyHandler(e.target.value),s[t].onPress(!0)))}),!1),window.ToolTip=new UILabel({id:"tool-tip"}),{keys:s,faces:a,panels:l,getLayout:function(){return n},getQuickRef:function(){return i},setup:function(){n=new Layout(e,t),i=new QuickRef(e),n.connect(),i.connect()},getPanel:h,addCallback:d,addCallbacks:function(e,t){e.forEach((e=>{d(e,t)}))},addProp:u,addProps:function(e,t){for(const s in e)u(s,e[s],t)},addUI:p,addUIs:function(e,t){if(Array.isArray(e))e.forEach((e=>{p(e,t)}));else for(const s in e){p({...e[s],face:s,row:!0},t)}}}}function Layout(e,t){const s=new UICollection({id:"container"}),a=new UISection({id:"ui",gridArea:"default",addPanelToSection:n});s.append(a);const l=new UISection({id:"ui-timeline",gridArea:"timeline",addPanelToSection:n});s.append(l);const i=new UISection({id:"main",gridArea:"main",addPanelToSection:n});function n(t,s,a){const l=e.ui.panels[t];s.panels.append(l),l.gridArea=a,l.dock()}return a.append(ToolTip),{default:a,timeline:l,main:i,container:s,connect:function(){e.ui.addProps({timelineLayout:{type:"UIToggleCheck",value:!0,label:"Timeline",callback:e=>{l.isVisible=e}},rightLayout:{type:"UIToggleCheck",value:!1,label:"▶/◀",callback:e=>{e?s.addClass("RL"):s.removeClass("RL")}},upLayout:{type:"UIToggleCheck",value:!1,label:"▼/▲",callback:e=>{e?s.addClass("UP"):s.removeClass("UP")}}},"layout")},addSelectPanels:function(e){a.addSelectorOptions(e),l.addSelectorOptions(e),i.addSelectorOptions(e)},addSelectOption:function(e,t){a.addSelectorOption(e,t),l.addSelectorOption(e,t),i.addSelectorOption(e,t)},getSettings:function(){return{default:a.settings,timeline:l.settings,main:i.settings}}}}function QuickRef(e){const t=[],s=[],a=[];let l;function i(){const s=new UIModal({title:"Add UI To Quick Ref",app:e,position:e.ui.panels.quick.position});const a=new UIInputList({listName:"quick-menu-list",options:t.map((e=>e.label)),escape:()=>{s.clear()},callback:e=>{s.clear(),function(e){const{type:s,params:a,prop:i}=t.find((t=>t.label===e));a.label=e;let n,o=l.addRow();n="prop"===s?new UI.Elements[a.type](a):new UIButton(a),o.append(new UILabel({text:e,css:{"margin-right":"auto"}})),o.append(n),o.append(new UIButton({text:"x",callback:()=>{l.removeRow(o)}}))}(e)}});s.add(a),a.focus()}function n(){const s=new UIModal({title:"Quick Menu",app:e,position:{x:window.innerWidth/2,y:window.innerHeight/2}});const a=new UIInputList({listName:"quick-menu-list",options:t.map((e=>e.label)),escape:()=>{s.clear()},callback:a=>{s.clear(),function(s){const a=t.find((e=>e.label===s));a&&("prop"===a.type?e.ui.faces[a.prop].update():a.params.callback())}(a)}});s.add(a),a.focus()}function o(){const t=new UIModal({title:"Key Commands",app:e,class:"key-command-list",position:{x:200,y:120}});for(let e=0;e<s.length;e++){const a=s[e];t.add(new UILabel({text:a.key+" --\x3e "+a.label,class:"break"}))}}return{connect:function(){l=e.ui.getPanel("quick",{label:"Quick Ref"}),e.ui.addCallbacks([{callback:n,text:"Menu",key:"ctrl-space"},{callback:i,text:"+"},{callback:o,text:"Key Commands",key:"ctrl-,"}]),e.ui.addProp("quickRefScale",{type:"UINumberStep",value:11,label:"Scale",callback:e=>{document.body.style.setProperty("--quick-ref-font-size",+e)},reset:!0,range:[10,40]})},registerCallback:function(e,a,l){t.push({label:`${e} > ${a}`,params:l,type:"callback"}),l.key&&s.push({key:l.key,label:`${e} > ${a}`})},registerProp:function(e,a,l,i){t.push({label:`${a} > ${l}`,prop:e,params:i,type:"prop"}),i.key&&s.push({key:i.key,label:`${a} > ${l}`})},getList:()=>a}}function Settings(e,t){let{name:s,workspaceFields:a,workspaces:l,appLoad:i,appSave:n}=t;const o=`settings-${s}`;function c(t){const s=e.ui.getLayout();for(const a in t){if("el"===a)continue;if(!e.ui.panels[a])continue;e.ui.panels[a].setup(t[a]);let l=e.ui.panels[a];t[a];s[l.gridArea||"default"].panels.append(l)}}function r(t){for(const s in t)"palettes"!==s&&"quickRef"!==s&&e.ui.faces[s]&&e.ui.faces[s].update(t[s])}function h(t){for(const s in t)e.ui.getLayout()[s].maxWidth.update(t[s].maxWidth),e.ui.getLayout()[s].maxWidthToggle.update(t[s].maxWidthToggle),void 0!==t[s].isVisible&&(e.ui.getLayout()[s].isVisible=t[s].isVisible)}function d(){const t={},s={};Object.keys(e.ui.faces).filter((t=>!e.ui.faces[t].ignoreSettings)).forEach((t=>{s[t]=e.ui.faces[t].value})),n&&Object.assign(s,n()),t.interface=s,t.panels={};for(const s in e.ui.panels)"el"!==s&&(t.panels[s]=e.ui.panels[s].settings);t.layout=e.ui.getLayout().getSettings(),t.quickRef=e.ui.getQuickRef().getList(),localStorage[o]=JSON.stringify(t)}function u(){if(localStorage[o]){const t=JSON.parse(localStorage[o]);c(t.panels),r(t.interface),h(t.layout),t.quickRef&&(e.ui.getQuickRef().list=t.quickRef,t.quickRef.forEach((e=>{console.log(e)}))),i&&i(t)}}function p(e){if(e)fetch(e).then((e=>e.json())).then((e=>{r(e.interface),c(e.panels),h(e.layout)})).catch((e=>{console.error(e)}));else{const e=document.createElement("input");e.type="file",e.click(),e.onchange=function(){for(let t,s=0;t=e.files[s];s++){if(!t.type.match("application/json"))continue;const e=new FileReader;e.onload=function(e){const t=JSON.parse(e.target.result);c(t.panels),r(t.interface),h(t.layout)},e.readAsText(t)}}}}return a||(a=[]),a=[...a,"timelineLayout","rightLayout","upLayout"],e.ui.addCallbacks([{callback:d,key:"ctrl-s",text:"Save"},{callback:u,text:"Load"},{callback:function(){localStorage.setItem(o,"")},text:"Clear"}],"settings"),e.ui.addCallbacks([{callback:function(){d();const t={};a.filter((t=>e.ui.faces[t])).forEach((s=>{t[s]=e.ui.faces[s].value}));const s=JSON.parse(localStorage.getItem(o)),l=JSON.stringify({panels:s.panels,layout:s.layout,interface:t}),i=prompt("Layout Name:","New Layout"),n=new Blob([l],{type:"application/x-download;charset=utf-8"});saveAs(n,`${i}.json`)},key:"alt-w",text:"Save"},{callback:p,text:"Load"}],"workspaces"),e.ui.addUI({row:!0,type:"UILabel",text:"Defaults",class:"break"},"workspaces"),l.forEach((t=>{const{text:s,url:a}=t;e.ui.addCallback({text:s,callback:()=>{p(a)}},"workspaces")})),{load:u}}UI.Elements.UIText=UIText,UI.Interface=Interface,UI.Settings=Settings;class UIButton extends UIElement{constructor(e){e.tag="span",super(e),this.addClass(e.btnClass||"btn"),this.text=this.el.textContent||e.text||e.onText,this.callback=e.callback,this.args=e.args||[],this.el.addEventListener("click",this.keyHandler.bind(this)),e.key&&this.setKey(e.key,`${this.el.textContent}`)}keyHandler(){this.callback(...this.args)}}UI.Elements.UIButton=UIButton;class UIColor extends UIInput{constructor(e){super(e),this.el.type="color",this.colors=[],this.args=e.args||[],this.el.addEventListener("input",(e=>{this.setColor(e.target.value)})),this.el.addEventListener("focus",(e=>{this.addColor(this.current)})),this.palette=new UICollection}addColor(e){const t=this;if(!this.colors.includes(e)&&e){this.colors.push(e);const s=new UIButton({text:e,css:{background:e},value:e,callback:function(){t.update(e)}});t.palette.append(s)}}setColor(e){this.current=e,this.callback(e,...this.args)}update(e,t){t||this.setColor(e),this.value=e}set value(e){this.addColor(e),this.current=e,super.value=e}get value(){return this.el.value}get html(){return[this.el,this.palette.el]}}UI.Elements.UIColor=UIColor;class UIDrag extends UIText{constructor(e){super(e),this.addClass("drag");const t={x:0,y:0,timeout:5,timer:0,prev:0,active:!1};function s(s){if(!t.active)return;const a={x:s.pageX-t.x,y:s.pageY-t.y},l=Math.abs(a.x)>Math.abs(a.y)?"x":"y";if(Math.abs(a[l])>10&&0===t.timer){const i="x"===l?1:-1;e.drag&&e.drag(i*Math.sign(a[l])),t.timer=t.timeout,t.x=s.pageX,t.y=s.pageY}else t.timer>0&&t.timer--}function a(e){t.active&&(t.active=!1,t.x=0,t.y=0,document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",a))}this.el.addEventListener("mousedown",(function(e){t.x=e.pageX,t.y=e.pageY,t.active=!0,document.addEventListener("mousemove",s),document.addEventListener("mouseup",a)})),void 0!==e.value&&(this.value=e.value)}}UI.Elements.UIDrag=UIDrag;class UIDragButton extends UIButton{constructor(e){super(e),this.down={x:0,y:0},this.el.addEventListener("mousemove",(e=>{this.down.x&&(this.dragging=!0)})),this.el.addEventListener("mousedown",(e=>{this.down.x=e.pageX})),document.addEventListener("mouseup",(e=>{if(this.dragging){const t=e.pageX-this.down.x;Math.abs(t)>10&&this.callback(t>0?1:-1,Math.abs(Math.ceil(t/lns.timeline.frameWidth)))}this.dragging=!1,this.down.x=0}))}}UI.Elements.UIDragButton=UIDragButton;class UIFile extends UIButton{constructor(e){super(e),this.multiple=e.multiple||!1,this.promptDefault=e.promptDefault,this.fileType=e.fileType||"application/json"}keyHandler(){const{callback:e,promptDefault:t,multiple:s,fileType:a}=this;const l=document.createElement("input");l.type="file",l.multiple=s,l.click(),l.onchange=function(){let s=prompt("Directory?",t);!function(t,s){for(let l,i=0;l=t[i];i++){if(!l.type.match(a))continue;const t=new FileReader;t.onload=function(t){const i="/"+s+"/"+l.name,n=l.name.split(".")[0];let o;o="application/json"===a?JSON.parse(t.target.result):t.target.result,e(o,n,i)},t.readAsText(l)}}(l.files,s)}}}UI.Elements.UIFile=UIFile;class UIInputList extends UICollection{constructor(e){super(e);const t=new UIElement({tag:"input",class:"search"});function s(s){t.el.blur(),e.callback&&e.callback(this.value)}t.el.setAttribute("list",e.listName),t.el.addEventListener("change",s),e.escape&&t.el.addEventListener("keydown",(a=>{"escape"===Cool.keys[a.which]&&(t.el.removeEventListener("change",s),e.escape())}));const a=new UIElement({tag:"datalist",id:e.listName});this.append(t,"input"),this.append(a,"list"),this.setOptions(e.options||[])}focus(){this.input.el.focus()}get value(){return this.input.el.value}set value(e){this.input.value=e}addOption(e,t){const s=document.createElement("option");s.value=s.textContent=e,t&&(s.textContent=t),this.list.el.appendChild(s)}setOptions(e){for(let t=0;t<e.length;t++){Array.from(this.list.el.options).map((e=>e.value)).includes(e[t])||this.addOption(e[t])}}}UI.Elements.UIInputList=UIInputList;class UILabel extends UIElement{constructor(e){e.tag="label",super(e),this.text=e.text}}UI.Elements.UILabel=UILabel;class UIList extends UICollection{constructor(e){super(e)}insertBefore(e,t){this.el.insertBefore(e.el,t.el)}get length(){return this.el.children.length}get children(){return this.el.children}addClass(e){for(let t=0;t<this.els.length;t++)this.els[t].classList.contains(e)||this.els[t].classList.add(e)}setId(e,t){this.children[t].id=e}removeIndex(e){this.children[e].remove()}looper(e,t,s){const a=s||this.length-2;for(let s=t||0;s<=a;s++)e(this.children[s])}}UI.Elements.UIList=UIList;class UIListStep extends UICollection{constructor(e){super(e),this.addClass("list-step"),this.addClass("ui-collection");const t=e.list;let s=void 0!==e.value?e.list.indexOf(e.value):0;e.callback&&(this.callback=e.callback),this.textInput=new UIDrag({value:e.value,class:"left-end",drag:e=>{s+e>=0&&s+e<t.length&&(s+=e),this.update(t[s])},callback:e=>{this.update(e)}});const a=new UIButton({text:"▼",class:"middle",callback:()=>{s>0&&(s-=1),this.update(t[s])}}),l=new UIButton({text:"▲",class:"right-end",callback:()=>{s<=t.length&&(s+=1),this.update(t[s])}});this.append(this.textInput),this.append(a),this.append(l)}update(e,t){this.value=e,!t&&this.callback&&(this.args?this.callback(e,...this.args):this.callback(e))}set value(e){this.textInput.value=e}get value(){return this.textInput.value}}UI.Elements.UIListStep=UIListStep;class UIModal extends UICollection{constructor(e){super({}),e.callback&&(this.callback=e.callback),this.addClass("modal"),e.class&&this.addClass(e.class),this.append(new UILabel({text:e.title})),document.getElementById("container").appendChild(this.el);const t=this;this.break=new UIElement({class:"break"}),this.append(this.break),this.submit=new UIButton({text:"Submit",callback:function(){e.callback&&e.callback(),t.clear()}}),this.append(this.submit),e.app.ui.keys.enter=this.submit,this.cancel=new UIButton({text:"x",callback:t=>{this.clear(),e.onClear&&e.onClear()}}),e.app.ui.keys.escape=this.cancel,this.append(this.cancel);let s=Math.max(16,e.position.x-100),a=Math.max(16,e.position.y-20);this.el.style.left=`${s}px`,this.el.style.top=`${a}px`}adjustPosition(){let e=parseInt(this.el.style.left),t=parseInt(this.el.style.top),s=parseInt(this.el.offsetWidth),a=parseInt(this.el.offsetHeight);e+s>window.innerWidth&&(this.el.style.left=e-s+"px"),t+a>window.innerHeight&&(this.el.style.top=t-a+"px")}add(e){Array.isArray(e.html)?e.html.forEach((e=>{this.el.insertBefore(e,this.break.el)})):this.el.insertBefore(e.el,this.break.el)}addBreak(e){this.add(new UIElement({class:"break"})),e&&this.addLabel(e)}addLabel(e){this.add(new UILabel({text:e}))}clear(){this.el.remove()}}UI.Elements.UIModal=UIModal;class UINumber extends UIText{constructor(e){super(e),this.el.classList.add("number"),this.placeholder||(this.placeholder=0,this.el.placeholder=0)}update(value,uiOnly){if(void 0!==value){if("string"==typeof value&&value.match(/\D/))try{value=eval(value)}catch(e){return void alert("Please enter a numerical value or mathematical expression.")}"string"==typeof value&&(value=+value),this.value=value,this.callback&&!uiOnly&&this.callback(value)}}keyHandler(e){this.update(+prompt(this.prompt))}}UI.Elements.UINumber=UINumber;class UINumberList extends UICollection{constructor(e){super(e),this.addClass("number-list"),this.list=[...e.list],e.callback&&(this.callback=e.callback);const t=new UIButton({text:"+",callback:()=>{this.addNumber(this.list.length,0)}}),s=new UIButton({text:"X",callback:()=>{this.list.pop(),this.removeK("n"+this.list.length)}});this.append(s),this.append(t);for(let e=0;e<this.list.length;e++)this.addNumber(e,this.list[e])}addNumber(e,t){const s=new UINumber({value:t,callback:t=>{this.list[e]=+t,this.callback&&this.callback(this.list)}});this.append(s,"n"+e)}}UI.Elements.UINumberList=UINumberList;class UINumberRange extends UICollection{constructor(e){super(e),this.callback=e.callback,this.args=e.args||[],this.numberInput=new UINumber({...e,callback:this.update.bind(this)}),this.range=new UIRange({...e,callback:this.update.bind(this)}),"change"===e.event&&this.range.el.addEventListener("input",(e=>{this.numberInput.el.placeholder=e.currentTarget.value})),void 0!==e.value&&(this.value=e.value)}get html(){return[this.numberInput.el,this.range.el]}keyHandler(e){this.update(+prompt(this.prompt))}update(e,t){t||this.callback(+e,...this.args),this.value=e}set value(e){this.numberInput.value=e,this.range.value=e}get value(){return+this.numberInput.value}}UI.Elements.UINumberRange=UINumberRange;class UINumberStep extends UICollection{constructor(params){super(params),this.addClass("number-step"),this.addClass("ui-collection"),this.prompt=params.prompt,this.callback=params.callback,this.args=params.args,this.step=+params.step||1,this.min=params.range?+params.range[0]:+params.min||0,this.max=params.range?+params.range[1]:+params.max||1e3,this.numberInput=new UIDrag({...params,class:"middle",drag:e=>{this.update(this.value+this.step*e)},callback:value=>{if("string"==typeof value&&value.match(/\D/))try{value=eval(value)}catch(e){return void alert("Please enter a numerical value or mathematical expression.")}this.update(+value)}}),this.stepDown=new UIButton({text:"◀",class:"left-end",callback:()=>{this.update(this.value-this.step)}}),this.stepUp=new UIButton({text:"▶",class:"right-end",callback:()=>{this.update(this.value+this.step)}}),this.append(this.stepDown),this.append(this.numberInput),this.append(this.stepUp)}keyHandler(e){this.update(+prompt(this.prompt))}update(e,t){if(void 0===e&&(e=prompt(this.prompt)),null==e||""===e)return console.trace(),alert("No value entered.");(e=+e)<this.min&&(e=this.min),e>this.max&&(e=this.max),this.value=e,t||(this.args?this.callback(e,...this.args):this.callback(e))}get html(){return this.el}set value(e){this.numberInput.value=+e}get value(){return this.numberInput.value}}UI.Elements.UINumberStep=UINumberStep;class UIPanel extends UICollection{constructor(e){super({id:`${e.id}-panel`}),this.id=e.id,this.isPanel=!0,this.addClass("panel"),this.addClass("undocked"),this.gridArea="default",this.rows=[],this.header=new UIRow,this.header.addClass("header"),this.append(this.header),this.open=new UIToggle({onText:"－",offText:"＋",class:"toggle",isOn:!0,callback:e=>{e?this.removeClass("closed"):this.addClass("closed")}}),this.header.append(this.open),this.header.append(new UILabel({text:e.label})),this.header.append(new UIButton({text:"X",class:"undock-btn",callback:this.undock.bind(this)})),this.orderBtn=new UIButton({text:this.order||"0",class:"order-btn",callback:()=>{this.order=+this.el.style.order+1,this.orderBtn.text=this.order}}),this.header.append(this.orderBtn),this.header.append(new UIButton({text:"[]",class:"block-btn",callback:()=>{this.el.classList.contains("block")?this.el.classList.remove("block"):this.el.classList.add("block")}})),this.header.append(new UIButton({text:"<",class:"headless-btn",callback:()=>{this.el.classList.contains("headless")?this.el.classList.remove("headless"):this.el.classList.add("headless")}}))}set order(e){this.orderBtn.text=e||"0",this.el.style.order=e}get order(){return this.el.style.order}get isDocked(){return!this.el.classList.contains("undocked")}get isBlock(){return this.el.classList.contains("block")}get isHeadless(){return this.el.classList.contains("headless")}get isOpen(){return this.open.value}get settings(){return{open:this.isOpen,docked:this.isDocked,order:this.order,block:this.isBlock,headless:this.isHeadless,gridArea:this.gridArea}}get lastRow(){return 0===this.rows.length?this.addRow():this.rows[this.rows.length-1]}close(){this.addClass("closed"),this.open.set(!1)}block(){this.el.classList.add("block")}headless(){this.el.classList.add("headless")}dock(){this.removeClass("undocked")}undock(){this.addClass("undocked")}addRow(e,t){const s=new UIRow({id:e,class:t});return this.append(s,e),this.rows.push(s),s}removeRow(e){const t=this.rows.indexOf(e);this.rows.splice(t,1),this.remove(e)}add(e,t,s){return(s||this.rows[this.rows.length-1]||this.addRow()).append(e,t),e}setup(e){e.docked?this.dock():this.undock(),e.open||this.close(),e.block&&this.block(),e.headless&&this.headless(),this.order=e.order,this.gridArea=e.gridArea}}UI.Elements.UIPanel=UIPanel;class UIRange extends UIInput{constructor(e){super(e),this.el.type="range";const[t,s]=e.range?[...e.range]:[e.min,e.max];this.setRange(t,s),this.value=e.value||e.min,e.step&&this.setStep(e.step),this.el.addEventListener(e.event||"input",(e=>{this.update(e.target.value)}))}keyHandler(e){this.update(+prompt(this.prompt))}update(e){this.el.value=e,this.el.blur(),this.callback(e)}setRange(e,t){this.el.min=e,this.el.max=t}setStep(e){this.el.step=e}}UI.Elements.UIRange=UIRange;class UIRow extends UICollection{constructor(e){super(e),this.addClass("row"),this.uiChildren=[],this.keys=[]}append(e,t){super.append(e,t),t&&this.keys.push(t),this.uiChildren.push(e)}clear(){for(const e in this.keys)delete this[e];for(this.keys=[];this.el.firstChild;)this.el.firstChild.value=null,this.el.removeChild(this.el.firstChild);this.uiChildren=[]}remove(e,t){super.remove(e,t);let s=this.uiChildren.indexOf(e);this.uiChildren.splice(s,1)}get children(){return this.uiChildren}}UI.Elements.UIRow=UIRow;class UISection extends UICollection{constructor(e){super(e),this.addClass("ui-section"),this.panels=new UICollection({id:e.id+"-panels",class:"panels"}),this.panels.append(new UIElement({class:"break"}));const t=new UICollection({id:e.id+"-header",class:"section-header"});this.selector=new UISelectButton({class:"selector",callback:t=>{e.addPanelToSection(t,this,e.gridArea)}}),t.append(this.selector),this.append(t),this.append(this.panels);const s=new UICollection({class:"width-collection"});t.append(s),s.append(new UILabel({text:"Width"})),this.maxWidth=new UINumber({value:500,callback:e=>{this.setProp("--max-width",e)}}),s.append(this.maxWidth),this.maxWidthToggle=new UIToggleCheck({callback:e=>{e?this.addClass("max-width"):this.removeClass("max-width")}}),s.append(this.maxWidthToggle),this._isVisible=!0;const a=new UICollection({class:"scale-collection"});t.append(a),a.append(new UILabel({text:"Scale"})),this.baseFontSize=new UINumberStep({value:11,min:10,max:40,callback:e=>{this.panels.setProp("--ui-scale",+e)}}),a.append(this.baseFontSize)}addSelectorOptions(e){e.forEach((e=>{const[t,s]=e;this.selector.select.addOption(t,s)}))}addSelectorOption(e,t){this.selector.select.addOption(e,t)}get isVisible(){return this._isVisible}set isVisible(e){this._isVisible=e,e?this.removeClass("hidden"):this.addClass("hidden")}get settings(){return{maxWidthToggle:this.maxWidthToggle.value,maxWidth:this.maxWidth.value,isVisible:this.isVisible,baseFontSize:this.baseFontSize.value}}}UI.Elements.UISection=UISection;class UISelect extends UIElement{constructor(e){e.tag="select",super(e),e.callback&&(this.callback=e.callback),this.setOptions(e.options||[]),e.selected&&(this.value=e.selected),e.value&&(this.value=e.value),this.el.addEventListener("change",(t=>{e.callback&&e.callback(t.target.value),t.target.blur()}))}get options(){return Array.from(this.el.options).map((e=>e.value))}update(e){this.options.includes(e)||this.addOption(e),this.value=e,this.callback&&this.callback(e)}removeOption(e){for(let t=0;t<this.el.children.length;t++)this.el.children[t].value==e&&this.el.children[t].remove()}addOption(e,t){const s=document.createElement("option");s.value=s.textContent=e,t&&(s.textContent=t),this.el.appendChild(s)}setOptions(e){for(let t=0;t<e.length;t++){const s=Array.from(this.el.options).map((e=>e.value)),{value:a,text:l}="string"==typeof e[t]?{value:e[t]}:e[t];s.includes(a)||this.addOption(a,l)}}}UI.Elements.UISelect=UISelect;class UISelectButton extends UICollection{constructor(e){super(e),e.callback&&(this.callback=e.callback),this.addClass("ui-collection");const t=new UISelect({options:e.options,callback:function(){}}),s=new UIButton({text:"+",css:{"margin-left":"1px"},callback:()=>{this.callback&&this.callback(t.value)}});this.append(t,"select"),this.append(s),e.btns&&e.btns.forEach((e=>{const s=new UIButton({text:e.text,css:{"margin-left":"1px"},callback:()=>{e.callback(t.value)}});this.append(s)}))}}UI.Elements.UISelectButton=UISelectButton;class UIToggle extends UIButton{constructor(e){super(e),this.onText=e.onText||e.text,this.offText=e.offText||e.text,this.isOn=e.isOn||e.value||!1,this.isOn&&this.on(),super.text=this.isOn?this.onText:this.offText,this.addClass("toggle")}update(e,t){e!==this.isOn&&(void 0===this.isOn&&(this.isOn=e),t||this.callback(e),this.set(e))}keyHandler(){this.set(!this.isOn),this.callback(this.value)}set(e){this.isOn=e,e?this.on():this.off()}toggle(){this.isOn=!this.isOn,this.isOn?this.on():this.off()}on(){this.text=this.onText,this.addClass("on")}off(){this.text=this.offText,this.removeClass("on")}get value(){return this.isOn}}UI.Elements.UIToggle=UIToggle;class UIToggleCheck extends UICollection{constructor(e){super(e),this.callback=e.callback,this.addClass("ui-collection"),this.check=new UIElement({tag:"input",class:"toggle-check"}),this.check.el.type="checkbox",this.check.el.checked=e.isOn||e.value||!1,this.check.el.addEventListener("change",(e=>{this.callback&&this.callback(e.target.checked),this.check.el.blur()})),this.el.appendChild(this.check.el)}get value(){return this.check.el.checked}keyHandler(e){this.update(void 0!==e?e:!this.value)}update(e){void 0===e&&(e=!this.value),this.check.el.checked=e,this.callback&&this.callback(e)}}UI.Elements.UIToggleCheck=UIToggleCheck;class UIChance extends UICollection{constructor(e){super(e),this.addClass("value-bg"),this.step=e.step,this.min=e.min,this.max=e.max,this.value=e.value,this.total=e.max-e.min,e.callback&&(this.callback=e.callback),this.drag=new UIDrag({value:e.value,drag:e=>{this.update(this.value+this.step*e*10)},callback:e=>{this.update(+e)}});const t=new UILabel({text:e.label});this.append(t),this.append(this.drag),this.setProp("--value-percent",Math.round((this.value-this.min)/this.total*100))}update(e,t){e<this.min&&(e=this.min),e>this.max&&(e=this.max),this.value=+e.toFixed(3),this.drag.value=this.value,this.setProp("--value-percent",Math.round((this.value-this.min)/this.total*100)),t||(this.args?this.callback(e,...this.args):this.callback(e))}}UI.Elements.UIChance=UIChance})();
//# sourceMappingURL=src_maps/ui.min.js.map
