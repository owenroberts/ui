Array.prototype.insert=function(t,e){this.splice(t,0,e)},Number.prototype.clamp=function(t,e){return Math.min(Math.max(this,t),e)},"undefined"!=typeof window&&(window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)}),Cool={},Cool.map=function(t,e,s,i,a){return i+(a-i)*(t-e)/(s-e)||0},Cool.padNumber=function(t,e){let s=""+t;for(;s.length<e;)s="0"+s;return s},Cool.random=function(t,e){return e?Math.random()*(e-t)+t:"number"==typeof t?Math.random()*t:Array.isArray(t)?t[Math.floor(Math.random()*t.length)]:"object"==typeof t?t[Cool.random(Object.keys(t))]:void 0},Cool.randomInt=function(t,e){return e||(e=t,t=0),Math.round(Math.random()*(e-t)+t)},Cool.chance=function(t){return Cool.random(1)<t},Cool.choice=function(t){return Array.isArray(t)||(t=[...arguments]),t[Math.floor(Math.random()*t.length)]},Cool.shuffle=function(t){let e,s=t.length;for(;0!=s;)e=Math.floor(Math.random()*s),s--,[t[s],t[e]]=[t[e],t[s]];return t},Cool.randomNormalInverse=function(){let t=0,e=0;for(;0===t;)t=Math.random();for(;0===e;)e=Math.random();const s=Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*e);let i=Cool.map(s,-3.5,3.5,0,1);return i>.5?i-.5:i+.5},Cool.componentToHex=function(t){var e=t.toString(16);return 1==e.length?"0"+e:e},Cool.HueToRgb=function(t,e,s){return s<0?s+=1:s>1&&(s-=1),255*(6*s<1?t+(e-t)*s*6:2*s<1?e:3*s<2?t+(e-t)*(2/3-s)*6:t)},Cool.hslToHex=function(t){for(var e=0,s=0,i=0,a=0,l=0,n=0,o=0;l<t.length;l++){var c=t.charCodeAt(l);if(c>=48&&c<=57)a=10*a+(c-48),o=1;else{if(1===o){switch(n){case 0:e=a%360/360;break;case 1:s=(a>100?100:a)/100;break;case 2:i=(a>100?100:a)/100}n++}o=0,a=0}}var h=e/(1/6),d=(t=(1-Math.abs(2*i-1))*s)*(1-Math.abs(h%2-1));switch(0|h){case 0:r=t,g=d,b=0;break;case 1:r=d,g=t,b=0;break;case 2:r=0,g=t,b=d;break;case 3:r=0,g=d,b=t;break;case 4:r=d,g=0,b=t;break;case 5:r=t,g=0,b=d}var u=i-.5*t;r+=u,g+=u,b+=u,r=255*r|0,g=255*g|0,b=255*b|0;var p="";return(o=48+(r>>4&15))>57&&(o+=7),p+=String.fromCharCode(o),(o=48+(15&r))>57&&(o+=7),p+=String.fromCharCode(o),(o=48+(g>>4&15))>57&&(o+=7),p+=String.fromCharCode(o),(o=48+(15&g))>57&&(o+=7),p+=String.fromCharCode(o),(o=48+(b>>4&15))>57&&(o+=7),p+=String.fromCharCode(o),(o=48+(15&b))>57&&(o+=7),p+=String.fromCharCode(o)},Cool.hexToRgb=function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},Cool.rgbToHsl=function(t){t.r/=255,t.g/=255,t.b/=255;var e,s,i=Math.max(t.r,t.g,t.b),a=Math.min(t.r,t.g,t.b),l=(i+a)/2;if(i==a)e=s=0;else{var n=i-a;switch(s=l>.5?n/(2-i-a):n/(i+a),i){case t.r:e=(t.g-t.b)/n+(t.g<t.b?6:0);break;case t.g:e=(t.b-t.r)/n+2;break;case t.b:e=(t.r-t.g)/n+4}e/=6}return[360*e+.5|0,100*s+.5|0,100*l+.5|0]},Cool.rgb2hex=function(t){var e=t.replace(/\s/g,"").match(/^rgba?\((\d+),(\d+),(\d+)/i);return e&&4===e.length?"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2):t},Cool.keys={9:"tab",13:"enter",27:"escape",32:"space",37:"left",38:"up",39:"right",40:"down",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",186:";",187:"+",192:"`",220:"backslash",222:"'"},Cool.Vector=function(t,e){return this.x=t||0,this.y=e||0,Array.isArray(this.x)&&(this.x=t[0],this.y=t[1]),this.random=function(t,e,s,i){return 1==arguments.length?(this.x=Cool.random(-t,t),this.y=Cool.random(-t,t)):2==arguments.length?(this.x=Cool.random(t,e),this.y=Cool.random(t,e)):4==arguments.length?(this.x=Cool.random(t,e),this.y=Cool.random(s,i)):console.error("You need 1, 2 or 4 arguments, dingus."),this},this.zero=function(){return!(Math.abs(this.x)>0||Math.abs(this.y)>0)},this.add=function(t){return this.x+=t.x,this.y+=t.y,this},this.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},this.multiply=function(t){return"object"==typeof t?(this.x*=t.x,this.y*=t.y):(this.x*=t,this.y*=t),this},this.divide=function(t){return"object"==typeof t?(this.x/=t.x,this.y/=t.y):(this.x/=t,this.y/=t),this},this.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},this.normalize=function(){var t=this.magnitude();return 0!=t&&1!=t&&this.divide(t),this},this.copy=function(){return new Cool.Vector(this.x,this.y)},this.distance=function(t){var e=new Cool.Vector(t.x,t.y);return e.subtract(this),e.magnitude()},this.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},this.getObj=function(){return{x:this.x,y:this.y}},this.clone=function(){return new Cool.Vector(this.x,this.y)},this.sameDirection=function(t){return Math.sign(this.x)==Math.sign(t.x)&&Math.sign(this.y)==Math.sign(t.y)},this.toArray=function(){return[this.x,this.y]},this},Cool.mobilecheck=function(){var t,e=!1;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e},Cool.testPerformance=function(){for(var t=new Date,e=15e7,s=e;s>0;s--);var i=new Date,a=Number(String(i.getSeconds())+"."+String(i.getMilliseconds()))-Number(String(t.getSeconds())+"."+String(t.getMilliseconds()));return t.getMinutes()!=i.getMinutes()&&(a=60*(i.getMinutes()-t.getMinutes())+a),spd=1.734/a,Math.round(1e3*a)/1e3},"undefined"!=typeof module&&(module.exports=Cool);class UIElement{constructor(t){t=t||{},this.el=document.getElementById(t.id)?document.getElementById(t.id):document.createElement(t.tag||"div");for(const e in t.css)this.el.style[e]=t.css[e];void 0!==t.id&&(this.el.id=t.id),t.class&&this.addClass(t.class),t.text&&(this.el.textContent=t.text)}set text(t){this.el.textContent=t}set value(t){this.el.value=t}get value(){return this.el.value}get position(){return{x:this.el.getBoundingClientRect().x,y:this.el.getBoundingClientRect().y}}setProp(t,e){this.el.style.setProperty(t,e)}getProp(t){return this.el.style.getPropertyValue(t)}keyHandler(){this.callback()}addClass(t){this.el.classList.add(t)}removeClass(t){this.el.classList.remove(t)}setKey(t,e){this.el.title=`${e||""} ~ ${t}`,this.el.addEventListener("mouseenter",this.onPress.bind(this)),this.el.addEventListener("mouseleave",this.onRelease.bind(this))}onPress(t){toolTip.text=`${this.el.title}`,toolTip.addClass("visible"),this.addClass("triggered"),!0===t&&setTimeout(this.onRelease.bind(this),400)}onRelease(){toolTip.removeClass("visible"),this.removeClass("triggered")}remove(){this.el.remove()}}class UICollection extends UIElement{constructor(t){super(t)}append(t,e){void 0!==e&&(this[e]=t),Array.isArray(t.html)?t.html.forEach((t=>{this.el.appendChild(t)})):this.el.appendChild(t.el)}remove(t,e){e&&delete this[e],this.el.removeChild(t.el)}removeK(t){this.el.removeChild(this[t].el),delete this[t]}clear(){for(let t=this.el.children.length-1;t>=0;--t)this.el.children[t].remove()}get uiList(){return Object.keys(this).filter((t=>"el"!==t)).map((t=>this[t]))}}class UIInput extends UIElement{constructor(t){t.tag="input",super(t),this.callback=t.callback,this.args=t.args||[],t.key&&this.setKey(t.key,t.label)}}class UIText extends UIInput{constructor(t){super(t),this.el.type="text",this.placeholder=this.el.placeholder||t.placeholder||t.text||t.value||"",this.el.placeholder=this.placeholder,this.el.addEventListener("focus",(t=>{this.el.select()})),this.el.addEventListener("keyup",(t=>{13==t.which&&(this.update(t.target.value),this.el.blur())})),this.el.addEventListener("blur",(t=>{this.value?this.value!=t.target.value&&t.target.value&&this.update(t.target.value):(this.el.placeholder=this.placeholder,this.el.value="")}))}keyHandler(t){this.update(prompt(this.prompt))}update(t,e){this.value=t,this.callback&&!e&&this.callback(t)}set value(t){this._value=t,this.placeholder=t,this.el.placeholder=t,this.el.value=""}get value(){return this._value||this.placeholder}}function Interface(t,e){const s=this,i={UILabel:UILabel,UIElement:UIElement,UIRange:UIRange,UIText:UIText,UINumber:UINumber,UINumberRange:UINumberRange,UINumberStep:UINumberStep,UIToggle:UIToggle,UIToggleCheck:UIToggleCheck,UIButton:UIButton,UIColor:UIColor,UISelect:UISelect,UISelectButton:UISelectButton,UICollection:UICollection,UIList:UIList,UIRow:UIRow,UIInput:UIInput,UIInputList:UIInputList,UIFile:UIFile};document.body.classList.add(Cool.mobilecheck()?"mobile":"desktop"),this.keys={},this.faces={},this.panels={},this.quickRef=new QuickRef(t),this.maxPanels=100,this.maxWidth=500,this.useMaxWidth=!1,this.layout=new Layout(this,e);let a=11;this.updateScale=function(t){t&&(a=+t),document.body.style.setProperty("--base-font-size",a)},this.keyDown=function(t){let e=Cool.keys[t.which];"space"===e&&t.preventDefault(),e=t.shiftKey?"shift-"+e:e,e=t.ctrlKey?"ctrl-"+e:e,e=t.altKey?"alt-"+e:e;const i=s.keys[e];e&&i&&"text"!==document.activeElement.type&&"number"!==document.activeElement.type&&!t.metaKey&&(t.preventDefault(),i.keyHandler(t.target.value),i.onPress(!0))},document.addEventListener("keydown",s.keyDown,!1),this.load=function(e,i){!async function(e,i){const a=await fetch(e).then((t=>t.json())),l={...await fetch("../ui/interface.json").then((t=>t.json()))};for(const t in a)l[t]?l[t].uis.push(...a[t].uis):l[t]={...a[t]};for(const e in l){const i=s.panels[e]||s.createPanel(e,l[e]),a=l[e].uis;for(let n=0;n<a.length;n++){const o=a[n];for(let t=0;t<o.list.length;t++)s.createUI(o.list[t],o.module,o.sub,i);"ui"===o.module&&o.sub&&(t.ui[o.sub].panel=i),l[e].addPanel&&!t[o.module].panel&&(t[o.module].panel=i)}}s.quickRef.addData(l),i&&i()}(e,i)},this.createPanel=function(t,e){const i=new UIPanel({id:t,label:e.label,onToggle:function(){lns.ui.panels.uiList.filter((t=>t.isOpen&&t.isDocked))}});return s.panels[t]=i,s.layout.addSelectOption(t,e.label),i},this.createUI=function(e,a,l,n){const o=l?t[a][l]:t[a],r={...e.params};e.key&&(r.key=e.key),e.callback&&(r.callback=o[e.callback]);for(const t in e.fromModule)r[t]=o[e.fromModule[t]];e.number&&(r.callback=function(t){o[e.number]=+t},r.value=+o[e.number]),e.string&&(r.callback=function(t){o[e.string]=t},r.value=o[e.string]),e.toggle&&(r.callback=function(t){o[e.toggle]=void 0!==t?t:!o[e.toggle]},r.value=o[e.number]),e.row&&n.addRow(),e.label&&n.add(new UILabel({text:e.label}));let c=new i[e.type](r);"UIRow"==e.type?n.addRow(e.k,r.class):e.k?n.add(c,void 0,e.k):n.add(c),r.prompt&&(c.prompt=r.prompt),r.key&&(s.keys[e.key]=c),e.face&&(s.faces[e.face]=c),e.face&&e.ignoreSettings&&(c.ignoreSettings=!0)},this.update=function(){t.uiUpdate()}}function Layout(t,e){const s=this,i=new UICollection({id:"container"});this.default=new UISection({id:"ui",gridArea:"default"},t),i.append(this.default),this.timeline=new UISection({id:"ui-timeline",gridArea:"timeline"},t),i.append(this.timeline),this.main=new UISection({id:"main",gridArea:"main"},t),window.toolTip=new UILabel({id:"tool-tip"}),this.default.append(window.toolTip),this.toggleTimeline=function(t){console.log("timeline toggle",t),s.timeline.isVisible=t},this.toggleRL=function(t){t?i.addClass("RL"):i.removeClass("RL")},this.toggleUP=function(t){t?i.addClass("UP"):i.removeClass("UP")},this.addSelectPanels=function(t){this.default.addSelectorOptions(t),this.timeline.addSelectorOptions(t),this.main.addSelectorOptions(t)},this.addSelectOption=function(t,e){this.default.addSelectorOption(t,e),this.timeline.addSelectorOption(t,e),this.main.addSelectorOption(t,e)},this.getSettings=function(){return{default:s.default.settings,timeline:s.timeline.settings,main:s.main.settings}}}function QuickRef(t){const e=this,s={};this.fontSize=11,this.list=[],this.setScale=function(t){e.fontSize=+t,document.body.style.setProperty("--quick-ref-font-size",+t)},this.reset=function(){lns.ui.faces.quickRefScale.update(11)},this.addRef=function(){const i=new UIModal({title:"panels",app:t,position:e.panel.position,callback:function(){const l={};if(s[a.value].uis.forEach((t=>{t.list.forEach((e=>{let s=!(!e.number&&!e.toggle);if(e.fromModule&&(s=!!e.fromModule.callback),s){const s=e.params?e.params.text||e.params.onText||e.params.label||e.face:e.fromModule.callback;e.mod=t.module,e.sub=t.sub,l[s]=e}}))})),Object.keys(l).length>0){const s=new UIModal({title:"ui",app:t,position:e.panel.position,callback:function(){const s=l[i.value];t.ui.createUI(s,s.mod,s.sub,e.panel);e.list.push(s)}}),i=new UISelect({options:Object.keys(l)});s.add(i);const a=new UIButton({text:"Execute",callback:function(){s.clear();const e=l[i.value],a=e.sub?t[e.mod][e.sub]:t[e.mod];e.fromModule&&e.fromModule.callback&&a[e.fromModule.callback](),e.number&&(a[e.number]=+prompt(e.prompt||e.label)),e.toggle&&(a[e.toggle]=!a[e.toggle])}});s.add(a)}else i.clear()}}),a=new UISelect({options:Object.keys(s)});i.add(a)},this.addData=function(t){for(const e in t)s[e]=t[e]},this.openQuickMenu=function(){let e=["UIRow","UILabel"],i={};Object.keys(s).forEach((t=>s[t].uis.forEach((a=>a.list.filter((t=>!e.includes(t.type))).filter((t=>"ctrl-space"!==t.key)).forEach((e=>{let l=s[t].label+" > ",n=e.label;!n&&e.params&&(n=e.params.text||e.params.onText||e.params.placeholder),n||(n=e.face),n||console.error("quick search fuck",e),l+=n,e.key&&(l+=` (key: ${e.key})`),i[l]={...e,module:a.module,sub:a.sub}}))))));const a=new UIModal({title:"Quick Func",app:t,position:{x:window.innerWidth/2,y:window.innerHeight/2},callback:()=>{const e=i[l.value],s=e.sub?t[e.module][e.sub]:t[e.module];let n;e.params&&e.params.args&&(n=[e.params.args]),e.face?t.ui.faces[e.face].update():e.callback?n?s[e.callback](...n):s[e.callback]():e.fromModule?e.fromModule.callback&&(n?s[e.fromModule.callback](...n):s[e.fromModule.callback]()):e.number?s[e.number]=+prompt(e.prompt||e.label):e.toggle&&(s[e.toggle]=!a[e.toggle])}}),l=new UIInputList({listName:"quick-menu-list",options:Object.keys(i),callback:function(){a.clear(),a.callback()}});a.add(l),l.input.el.focus(),l.input.el.addEventListener("keydown",(t=>{"escape"===Cool.keys[t.which]&&a.clear()}))}}function Settings(t,e,s,i){const a=this,l=`settings-${e}`;function n(e){for(const s in e){if("el"===s)continue;if(!t.ui.panels[s])continue;t.ui.panels[s].setup(e[s]);let i=t.ui.panels[s];e[s];t.ui.layout[i.gridArea].panels.append(i)}}function o(e){for(const s in e)"palettes"!==s&&"quickRef"!==s&&t.ui.faces[s]&&t.ui.faces[s].update(e[s])}function r(e){for(const s in e)t.ui.layout[s].maxWidth.update(e[s].maxWidth),t.ui.layout[s].maxWidthToggle.update(e[s].maxWidthToggle),void 0!==e[s].isVisible&&(t.ui.layout[s].isVisible=e[s].isVisible)}this.save=function(){const e={},i={};Object.keys(t.ui.faces).filter((e=>!t.ui.faces[e].ignoreSettings)).forEach((e=>{i[e]=t.ui.faces[e].value}));const a=s?{...i,...s()}:{...i};e.interface=a,e.panels={};for(const s in t.ui.panels)"el"!==s&&(e.panels[s]=t.ui.panels[s].settings);e.layout=t.ui.layout.getSettings(),e.quickRef=t.ui.quickRef.list,localStorage[l]=JSON.stringify(e)},this.load=function(e){if(localStorage[l]){const e=JSON.parse(localStorage[l]);n(e.panels),o(e.interface),r(e.layout),e.quickRef&&(t.ui.quickRef.list=e.quickRef,e.quickRef.forEach((e=>{t.ui.createUI(e,e.mod,e.sub,t.ui.panels.quickRef)})))}},this.clear=function(){localStorage.setItem(l,"")},this.toggleSaveSettings=function(){t.files.saveSettingsOnUnload=!t.files.saveSettingsOnUnload},i||(i=[]),i=[...i,"timelineLayout","rightLayout","upLayout"],this.saveLayout=function(){a.save();const e={};i.forEach((s=>{e[s]=t.ui.faces[s].value}));const s=JSON.parse(localStorage.getItem(l)),n=JSON.stringify({panels:s.panels,layout:s.layout,interface:e}),o=prompt("Layout Name:","New Layout"),r=new Blob([n],{type:"application/x-download;charset=utf-8"});saveAs(r,`${o}.json`)},this.loadLayoutFile=function(t){if(t)fetch(t).then((t=>t.json())).then((t=>{o(t.interface),n(t.panels),r(t.layout)})).catch((t=>{console.error(t)}));else{const t=document.createElement("input");t.type="file",t.click(),t.onchange=function(){for(let e,s=0;e=t.files[s];s++){if(!e.type.match("application/json"))continue;const t=new FileReader;t.onload=function(t){const e=JSON.parse(t.target.result);n(e.panels),o(e.interface),r(e.layout)},t.readAsText(e)}}}}}class UIButton extends UIElement{constructor(t){t.tag="span",super(t),this.addClass(t.type||"btn"),this.text=this.el.textContent||t.text||t.onText,this.callback=t.callback,this.args=t.args||[],this.el.addEventListener("click",this.keyHandler.bind(this)),t.key&&this.setKey(t.key,`${this.el.textContent}`)}keyHandler(){this.callback(...this.args)}}class UIColor extends UIInput{constructor(t){super(t),this.el.type="color",this.colors=[],this.args=t.args||[],this.el.addEventListener("input",(t=>{this.setColor(t.target.value)})),this.el.addEventListener("focus",(t=>{this.addColor(this.current)})),this.palette=new UICollection}addColor(t){const e=this;if(!this.colors.includes(t)&&t){this.colors.push(t);const s=new UIButton({text:t,css:{background:t},value:t,callback:function(){e.update(t)}});e.palette.append(s)}}setColor(t){this.current=t,this.callback(t,...this.args)}update(t,e){e||this.setColor(t),this.value=t}set value(t){this.addColor(t),this.current=t,super.value=t}get value(){return this.el.value}get html(){return[this.el,this.palette.el]}}class UIDrag extends UIText{constructor(t){super(t),this.addClass("drag");const e={x:0,y:0,timeout:5,timer:0,prev:0,active:!1};function s(s){if(!e.active)return;const i={x:s.pageX-e.x,y:s.pageY-e.y},a=Math.abs(i.x)>Math.abs(i.y)?"x":"y";if(Math.abs(i[a])>10&&0===e.timer){const l="x"===a?1:-1;t.drag&&t.drag(l*Math.sign(i[a])),e.timer=e.timeout,e.x=s.pageX,e.y=s.pageY}else e.timer>0&&e.timer--}function i(t){e.active&&(e.active=!1,e.x=0,e.y=0,document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",i))}this.el.addEventListener("mousedown",(function(t){e.x=t.pageX,e.y=t.pageY,e.active=!0,document.addEventListener("mousemove",s),document.addEventListener("mouseup",i)})),void 0!==t.value&&(this.value=t.value)}}class UIDragButton extends UIButton{constructor(t){super(t),this.down={x:0,y:0},this.el.addEventListener("mousemove",(t=>{this.down.x&&(this.dragging=!0)})),this.el.addEventListener("mousedown",(t=>{this.down.x=t.pageX})),document.addEventListener("mouseup",(t=>{if(this.dragging){const e=t.pageX-this.down.x;Math.abs(e)>10&&this.callback(e>0?1:-1,Math.abs(Math.ceil(e/lns.ui.timeline.frameWidth)))}this.dragging=!1,this.down.x=0}))}}class UIFile extends UIButton{constructor(t){super(t),this.multiple=t.multiple||!1,this.promptDefault=t.promptDefault,this.fileType=t.fileType||"application/json"}keyHandler(){const{callback:t,promptDefault:e,multiple:s,fileType:i}=this;const a=document.createElement("input");a.type="file",a.multiple=s,a.click(),a.onchange=function(){let s=prompt("Directory?",e);!function(e,s){for(let a,l=0;a=e[l];l++){if(!a.type.match(i))continue;const e=new FileReader;e.onload=function(e){const l="/"+s+"/"+a.name,n=a.name.split(".")[0];let o;o="application/json"===i?JSON.parse(e.target.result):e.target.result,t(o,n,l)},e.readAsText(a)}}(a.files,s)}}}class UIInputList extends UICollection{constructor(t){super(t),this.input=new UIElement({tag:"input",class:"search"}),this.input.el.setAttribute("list",t.listName),this.input.el.addEventListener("change",(e=>{this.input.el.blur(),t.callback()&&t.callback()})),this.list=new UIElement({tag:"datalist",id:t.listName}),this.setOptions(t.options||[])}get html(){return[this.input.el,this.list.el]}get value(){return this.input.el.value}addOption(t,e,s){const i=document.createElement("option");i.value=i.textContent=t,e&&(i.selected="selected"),s&&(i.textContent=s),this.list.el.appendChild(i)}setOptions(t,e){for(let s=0;s<t.length;s++){Array.from(this.list.el.options).map((t=>t.value)).includes(t[s])||this.addOption(t[s],e==t[s])}}}class UILabel extends UIElement{constructor(t){t.tag="label",super(t),this.text=t.text}}class UIList extends UICollection{constructor(t){super(t)}insertBefore(t,e){this.el.insertBefore(t.el,e.el)}get length(){return this.el.children.length}get children(){return this.el.children}addClass(t){for(let e=0;e<this.els.length;e++)this.els[e].classList.contains(t)||this.els[e].classList.add(t)}setId(t,e){this.children[e].id=t}removeIndex(t){this.children[t].remove()}looper(t,e,s){const i=s||this.length-2;for(let s=e||0;s<=i;s++)t(this.children[s])}}class UIListStep extends UICollection{constructor(t){super(t),this.addClass("list-step"),this.addClass("ui-collection");const e=t.list;let s=void 0!==t.value?t.list.indexOf(t.value):0;t.callback&&(this.callback=t.callback),this.textInput=new UIDrag({value:t.value,class:"left-end",drag:t=>{s+t>=0&&s+t<e.length&&(s+=t),this.update(e[s])},callback:t=>{this.update(t)}});const i=new UIButton({text:"▼",class:"middle",callback:()=>{s>0&&(s-=1),this.update(e[s])}}),a=new UIButton({text:"▲",class:"right-end",callback:()=>{s<=e.length&&(s+=1),this.update(e[s])}});this.append(this.textInput),this.append(i),this.append(a)}update(t,e){this.value=t,!e&&this.callback&&(this.args?this.callback(t,...this.args):this.callback(t))}set value(t){this.textInput.value=t}get value(){return this.textInput.value}}class UIModal extends UICollection{constructor(t){super({}),t.callback&&(this.callback=t.callback),this.addClass("modal"),this.append(new UILabel({text:t.title})),document.getElementById("container").appendChild(this.el);const e=this;this.break=new UIElement({class:"break"}),this.append(this.break),this.submit=new UIButton({text:"Submit",callback:function(){t.callback&&t.callback(),e.clear()}}),this.append(this.submit),t.app.ui.keys.enter=this.submit,this.cancel=new UIButton({text:"x",callback:e=>{this.clear(),t.onClear&&t.onClear()}}),t.app.ui.keys.escape=this.cancel,this.append(this.cancel);let s=Math.max(16,t.position.x-100),i=Math.max(16,t.position.y-20);this.el.style.left=`${s}px`,this.el.style.top=`${i}px`}adjustPosition(){let t=parseInt(this.el.style.left),e=parseInt(this.el.style.top),s=parseInt(this.el.offsetWidth),i=parseInt(this.el.offsetHeight);t+s>window.innerWidth&&(this.el.style.left=t-s+"px"),e+i>window.innerHeight&&(this.el.style.top=e-i+"px")}add(t){Array.isArray(t.html)?t.html.forEach((t=>{this.el.insertBefore(t,this.break.el)})):this.el.insertBefore(t.el,this.break.el)}addBreak(t){this.add(new UIElement({class:"break"})),t&&this.addLabel(t)}addLabel(t){this.add(new UILabel({text:t}))}clear(){this.el.remove()}}class UINumber extends UIText{constructor(t){super(t),this.el.classList.add("number"),this.placeholder||(this.placeholder=0,this.el.placeholder=0)}update(value,uiOnly){if(void 0!==value){if("string"==typeof value&&value.match(/\D/))try{value=eval(value)}catch(t){return void alert("Please enter a numerical value or mathematical expression.")}this.value=value,this.callback&&!uiOnly&&this.callback(value)}}keyHandler(t){this.update(+prompt(this.prompt))}}class UINumberList extends UICollection{constructor(t){super(t),this.addClass("number-list"),this.list=[...t.list],t.callback&&(this.callback=t.callback);const e=new UIButton({text:"+",callback:()=>{this.addNumber(this.list.length,0)}}),s=new UIButton({text:"X",callback:()=>{this.list.pop(),this.removeK("n"+this.list.length)}});this.append(s),this.append(e);for(let t=0;t<this.list.length;t++)this.addNumber(t,this.list[t])}addNumber(t,e){const s=new UINumber({value:e,callback:e=>{this.list[t]=+e,this.callback&&this.callback(this.list)}});this.append(s,"n"+t)}}class UINumberRange extends UICollection{constructor(t){super(t),this.callback=t.callback,this.args=t.args||[],this.numberInput=new UINumber({...t,callback:this.update.bind(this)}),this.range=new UIRange({...t,callback:this.update.bind(this)}),"change"===t.event&&this.range.el.addEventListener("input",(t=>{this.numberInput.el.placeholder=t.currentTarget.value})),void 0!==t.value&&(this.value=t.value)}get html(){return[this.numberInput.el,this.range.el]}keyHandler(t){this.update(+prompt(this.prompt))}update(t,e){e||this.callback(+t,...this.args),this.value=t}set value(t){this.numberInput.value=t,this.range.value=t}get value(){return+this.numberInput.value}}class UINumberStep extends UICollection{constructor(t){super(t),this.addClass("number-step"),this.addClass("ui-collection"),this.callback=t.callback,this.args=t.args,this.step=+t.step||1,this.min=+t.min||0,this.max=+t.max||100,this.numberInput=new UIDrag({...t,class:"middle",drag:t=>{this.update(this.value+this.step*t)},callback:t=>{this.update(+t)}}),this.stepDown=new UIButton({text:"◀",class:"left-end",callback:()=>{this.update(this.value-this.step)}}),this.stepUp=new UIButton({text:"▶",class:"right-end",callback:()=>{this.update(this.value+this.step)}}),this.append(this.stepDown),this.append(this.numberInput),this.append(this.stepUp)}keyHandler(t){this.update(+prompt(this.prompt))}update(t,e){t<this.min&&(t=this.min),t>this.max&&(t=this.max),this.value=t,e||(this.args?this.callback(t,...this.args):this.callback(t))}get html(){return this.el}set value(t){this.numberInput.value=+t}get value(){return this.numberInput.value}}class UIPanel extends UICollection{constructor(t){super({id:`${t.id}-panel`}),this.addClass("panel"),this.addClass("undocked"),this.gridArea="default",this.rows=[],this.header=new UIRow,this.header.addClass("header"),this.append(this.header),this.open=new UIToggle({onText:"－",offText:"＋",type:"toggle",isOn:!0,callback:()=>{this.open.isOn?this.removeClass("closed"):this.addClass("closed")}}),this.header.append(this.open),this.header.append(new UILabel({text:t.label})),this.header.append(new UIButton({text:"X",type:"undock-btn",callback:this.undock.bind(this)})),this.orderBtn=new UIButton({text:this.order||"0",type:"order-btn",callback:()=>{this.order=+this.el.style.order+1,this.orderBtn.text=this.order}}),this.header.append(this.orderBtn),this.header.append(new UIButton({text:"[]",type:"block-btn",callback:()=>{this.el.classList.contains("block")?this.el.classList.remove("block"):this.el.classList.add("block")}})),this.header.append(new UIButton({text:"<",type:"headless-btn",callback:()=>{this.el.classList.contains("headless")?this.el.classList.remove("headless"):this.el.classList.add("headless")}}))}set order(t){this.orderBtn.text=t||"0",this.el.style.order=t}get order(){return this.el.style.order}get isDocked(){return!this.el.classList.contains("undocked")}get isBlock(){return this.el.classList.contains("block")}get isHeadless(){return this.el.classList.contains("headless")}get isOpen(){return this.open.value}get settings(){return{open:this.isOpen,docked:this.isDocked,order:this.order,block:this.isBlock,headless:this.isHeadless,gridArea:this.gridArea}}get lastRow(){return 0===this.rows.length?this.addRow():this.rows[this.rows.length-1]}close(){this.addClass("closed"),this.open.set(!1)}block(){this.el.classList.add("block")}headless(){this.el.classList.add("headless")}dock(){this.removeClass("undocked")}undock(){this.addClass("undocked")}addRow(t,e){const s=new UIRow({class:e,id:t});return this.append(s,t),this.rows.push(s),s}removeRow(t){const e=this.rows.indexOf(t);this.rows.splice(e,1),this.remove(t)}add(t,e,s){(e||this.rows[this.rows.length-1]||this.addRow()).append(t,s)}setup(t){t.docked?this.dock():this.undock(),t.open||this.close(),t.block&&this.block(),t.headless&&this.headless(),this.order=t.order,this.gridArea=t.gridArea}}class UIRange extends UIInput{constructor(t){super(t),this.el.type="range",this.setRange(t.min,t.max),this.value=t.value||t.min,t.step&&this.setStep(t.step),this.el.addEventListener(t.event||"input",(t=>{this.update(t.target.value)}))}keyHandler(t){this.update(+prompt(this.prompt))}update(t){this.el.value=t,this.el.blur(),this.callback(t)}setRange(t,e){this.el.min=t,this.el.max=e}setStep(t){this.el.step=t}}class UIRow extends UICollection{constructor(t){super(t),this.addClass("row"),this.uiChildren=[],this.keys=[]}append(t,e){super.append(t,e),e&&this.keys.push(e),this.uiChildren.push(t)}clear(){for(const t in this.keys)delete this[t];for(this.keys=[];this.el.firstChild;)this.el.firstChild.value=null,this.el.removeChild(this.el.firstChild);this.uiChildren=[]}remove(t,e){super.remove(t,e);let s=this.uiChildren.indexOf(t);this.uiChildren.splice(s,1)}get children(){return this.uiChildren}}class UISection extends UICollection{constructor(t,e){super(t),this.addClass("ui-section"),this.panels=new UICollection({id:t.id+"-panels",class:"panels"}),this.panels.append(new UIElement({class:"break"}));const s=new UICollection({class:"section-header"});this.selector=new UISelectButton({class:"selector",callback:s=>{const i=e.panels[s];this.panels.append(i),i.gridArea=t.gridArea,i.dock()}}),s.append(this.selector),this.append(s),this.append(this.panels);const i=new UICollection({class:"width-collection"});s.append(i),i.append(new UILabel({text:"Width"})),this.maxWidth=new UINumber({value:500,callback:t=>{this.setProp("--max-width",t)}}),i.append(this.maxWidth),this.maxWidthToggle=new UIToggleCheck({callback:t=>{t?this.addClass("max-width"):this.removeClass("max-width")}}),i.append(this.maxWidthToggle),this._isVisible=!0;const a=new UICollection({class:"scale-collection"});s.append(a),a.append(new UILabel({text:"Scale"})),this.baseFontSize=new UINumberStep({value:11,min:10,max:40,callback:t=>{this.panels.setProp("--ui-scale",+t)}}),a.append(this.baseFontSize)}addSelectorOptions(t){t.forEach((t=>{const[e,s]=t;this.selector.select.addOption(e,!1,s)}))}addSelectorOption(t,e){this.selector.select.addOption(t,!1,e)}get isVisible(){return this._isVisible}set isVisible(t){this._isVisible=t,t?this.removeClass("hidden"):this.addClass("hidden")}get settings(){return{maxWidthToggle:this.maxWidthToggle.value,maxWidth:this.maxWidth.value,isVisible:this.isVisible,baseFontSize:this.baseFontSize.value}}}class UISelect extends UIElement{constructor(t){t.tag="select",super(t),t.callback&&(this.callback=t.callback),this.setOptions(t.options||[],t.selected),this.el.addEventListener("change",(function(e){t.callback&&t.callback(e.target.value),e.target.blur()}))}update(t){this.value=t,this.callback&&this.callback(t)}removeOption(t){for(let e=0;e<this.el.children.length;e++)this.el.children[e].value==t&&this.el.children[e].remove()}addOption(t,e,s){const i=document.createElement("option");i.value=i.textContent=t,e&&(i.selected="selected"),s&&(i.textContent=s),this.el.appendChild(i)}setOptions(t,e){for(let s=0;s<t.length;s++){const i=Array.from(this.el.options).map((t=>t.value)),{value:a,text:l}="string"==typeof t[s]?{value:t[s]}:t[s];i.includes(a)||this.addOption(a,e==t[s],l)}}}class UISelectButton extends UICollection{constructor(t){super(t),t.callback&&(this.callback=t.callback),this.addClass("ui-collection");const e=new UISelect({options:t.options,callback:function(){}}),s=new UIButton({text:"+",css:{"margin-left":"1px"},callback:()=>{this.callback&&this.callback(e.value)}});this.append(e,"select"),this.append(s),t.btns&&t.btns.forEach((t=>{const s=new UIButton({text:t.text,css:{"margin-left":"1px"},callback:()=>{t.callback(e.value)}});this.append(s)}))}}class UIToggle extends UIButton{constructor(t){super(t),this.onText=t.onText||t.text,this.offText=t.offText||t.text,super.text=this.offText,this.isOn=!1,t.isOn&&this.toggle(),this.addClass("toggle")}update(t,e){t!==this.isOn&&(void 0===this.isOn&&(this.isOn=t),e||this.callback(t),this.set(t))}keyHandler(){this.toggle(),this.callback(this.value)}set(t){this.isOn=t,t?this.on():this.off()}toggle(){this.isOn=!this.isOn,this.isOn?this.on():this.off()}on(){this.text=this.onText,this.addClass("on")}off(){this.text=this.offText,this.removeClass("on")}get value(){return this.isOn}}class UIToggleCheck extends UICollection{constructor(t){super(t),this.callback=t.callback,this.addClass("ui-collection"),this.check=new UIElement({tag:"input",class:"toggle-check"}),t.label&&this.append(new UILabel({text:t.label})),this.check.el.type="checkbox",this.check.el.checked=t.isOn||!1,this.check.el.addEventListener("change",(t=>{this.callback&&this.callback(t.target.checked),this.check.el.blur()})),this.el.appendChild(this.check.el)}get value(){return this.check.el.checked}keyHandler(t){this.update(void 0!==t?t:!this.value)}update(t){this.check.el.checked=t,this.callback&&this.callback(t)}}class UIChance extends UICollection{constructor(t){super(t),this.addClass("value-bg"),this.step=t.step,this.min=t.min,this.max=t.max,this.value=t.value,this.total=t.max-t.min,t.callback&&(this.callback=t.callback),this.drag=new UIDrag({value:t.value,drag:t=>{this.update(this.value+this.step*t*10)},callback:t=>{this.update(+t)}});const e=new UILabel({text:t.label});this.append(e),this.append(this.drag),this.setProp("--value-percent",Math.round((this.value-this.min)/this.total*100))}update(t,e){t<this.min&&(t=this.min),t>this.max&&(t=this.max),this.value=+t.toFixed(3),this.drag.value=this.value,this.setProp("--value-percent",Math.round((this.value-this.min)/this.total*100)),e||(this.args?this.callback(t,...this.args):this.callback(t))}}
//# sourceMappingURL=src_maps/ui.min.js.map
